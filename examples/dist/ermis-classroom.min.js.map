{"version":3,"file":"ermis-classroom.min.js","sources":["../src/events/EventEmitter.js","../src/api/ApiClient.js","../src/core/Participant.js","../src/media/Publisher.js","../src/media/Subscriber.js","../src/media/AudioMixer.js","../src/core/Room.js","../src/core/SubRoom.js","../src/core/ErmisClient.js","../src/index.js","../src/raptorQ/raptorq_wasm.js"],"sourcesContent":["/**\n * Base EventEmitter class for handling events across the SDK\n */\nclass EventEmitter {\n  constructor() {\n    this._events = new Map();\n  }\n\n  on(event, listener) {\n    if (!this._events.has(event)) {\n      this._events.set(event, []);\n    }\n    this._events.get(event).push(listener);\n    return this;\n  }\n\n  off(event, listener) {\n    if (!this._events.has(event)) return this;\n\n    const listeners = this._events.get(event);\n    const index = listeners.indexOf(listener);\n    if (index !== -1) {\n      listeners.splice(index, 1);\n    }\n\n    if (listeners.length === 0) {\n      this._events.delete(event);\n    }\n    return this;\n  }\n\n  emit(event, ...args) {\n    if (!this._events.has(event)) return false;\n\n    const listeners = this._events.get(event);\n    listeners.forEach((listener) => {\n      try {\n        listener(...args);\n      } catch (error) {\n        console.error(`Error in event listener for ${event}:`, error);\n      }\n    });\n    return true;\n  }\n\n  once(event, listener) {\n    const onceWrapper = (...args) => {\n      this.off(event, onceWrapper);\n      listener(...args);\n    };\n    return this.on(event, onceWrapper);\n  }\n\n  removeAllListeners(event) {\n    if (event) {\n      this._events.delete(event);\n    } else {\n      this._events.clear();\n    }\n    return this;\n  }\n\n  listenerCount(event) {\n    return this._events.has(event) ? this._events.get(event).length : 0;\n  }\n}\n\nexport default EventEmitter;\n","/**\n * API Client for handling HTTP requests to Ermis Meeting API\n */\nclass ApiClient {\n  constructor(config) {\n    this.host = config.host || \"daibo.ermis.network:9992\";\n    this.apiBaseUrl = config.apiUrl || `https://${this.host}/meeting`;\n    this.jwtToken = null;\n    this.userId = null;\n  }\n\n  /**\n   * Set authentication token and user ID\n   */\n  setAuth(token, userId) {\n    this.jwtToken = token;\n    this.userId = userId;\n  }\n\n  /**\n   * Generic API call method\n   */\n  async apiCall(endpoint, method = \"GET\", body = null) {\n    if (!this.userId) {\n      throw new Error(\"Please authenticate first\");\n    }\n\n    if (!this.jwtToken) {\n      throw new Error(\"JWT token not found\");\n    }\n\n    const options = {\n      method,\n      headers: {\n        Authorization: `Bearer ${this.jwtToken}`,\n        \"Content-Type\": \"application/json\",\n      },\n    };\n\n    if (body) {\n      options.body = JSON.stringify(body);\n    }\n\n    try {\n      const response = await fetch(`${this.apiBaseUrl}${endpoint}`, options);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error(\"API call failed:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get dummy token for authentication\n   */\n  async getDummyToken(userId) {\n    const endpoint = \"/get-token\";\n    const options = {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ sub: userId }),\n    };\n\n    try {\n      const response = await fetch(`${this.apiBaseUrl}${endpoint}`, options);\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error(\"Token request failed:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Create a new room\n   */\n  async createRoom(roomName, roomType = \"main\") {\n    return await this.apiCall(\"/rooms\", \"POST\", {\n      room_name: roomName,\n      room_type: roomType,\n    });\n  }\n\n  /**\n   * List available rooms\n   */\n  async listRooms(page = 1, perPage = 20) {\n    return await this.apiCall(\"/rooms/list\", \"POST\", {\n      list_query: {\n        page,\n        per_page: perPage,\n        sort_by: \"created_at\",\n        sort_order: \"desc\",\n      },\n      conditions: {\n        is_active: true,\n      },\n    });\n  }\n\n  /**\n   * Get room details by ID\n   */\n  async getRoomById(roomId) {\n    return await this.apiCall(`/rooms/${roomId}`);\n  }\n\n  /**\n   * Join a room by room code\n   */\n  async joinRoom(roomCode, appName = \"Ermis-Meeting\") {\n    return await this.apiCall(\"/rooms/join\", \"POST\", {\n      room_code: roomCode,\n      app_name: appName,\n    });\n  }\n\n  /**\n   * Create a sub room\n   */\n  async createSubRoom(parentRoomId, subRoomName, subRoomType = \"breakout\") {\n    return await this.apiCall(\"/rooms\", \"POST\", {\n      room_name: subRoomName,\n      room_type: subRoomType,\n      parent_room_id: parentRoomId,\n    });\n  }\n\n  /**\n   * Get sub rooms of a parent room\n   */\n  async getSubRooms(parentRoomId) {\n    return await this.apiCall(`/rooms/${parentRoomId}/sub-rooms`);\n  }\n\n  /**\n   * Leave a room\n   */\n  async leaveRoom(roomId, membershipId) {\n    return await this.apiCall(\n      `/rooms/${roomId}/members/${membershipId}`,\n      \"DELETE\"\n    );\n  }\n\n  /**\n   * Switch to sub room\n   */\n  async switchToSubRoom(roomId, subRoomCode) {\n    return await this.apiCall(\"/rooms/switch\", \"POST\", {\n      room_id: roomId,\n      sub_room_code: subRoomCode,\n    });\n  }\n\n  /**\n   * Get room members\n   */\n  async getRoomMembers(roomId) {\n    return await this.apiCall(`/rooms/${roomId}/members`);\n  }\n\n  /**\n   * Update room settings\n   */\n  async updateRoom(roomId, updates) {\n    return await this.apiCall(`/rooms/${roomId}`, \"PATCH\", updates);\n  }\n\n  /**\n   * Delete/Close room\n   */\n  async deleteRoom(roomId) {\n    return await this.apiCall(`/rooms/${roomId}`, \"DELETE\");\n  }\n}\n\nexport default ApiClient;\n","import EventEmitter from \"../events/EventEmitter.js\";\n\n/**\n * Represents a participant in a meeting room\n */\nclass Participant extends EventEmitter {\n  constructor(config) {\n    super();\n\n    this.userId = config.userId;\n    this.streamId = config.streamId;\n    this.membershipId = config.membershipId;\n    this.role = config.role || \"participant\";\n    this.roomId = config.roomId;\n    this.isLocal = config.isLocal || false;\n\n    // Media state\n    this.isAudioEnabled = true;\n    this.isVideoEnabled = true;\n    this.isPinned = false;\n    this.isHandRaised = false;\n\n    // Media components\n    this.publisher = null;\n    this.subscriber = null;\n\n    // Screen share state\n    this.isScreenSharing = config.isScreenSharing || false;\n    this.screenSubscriber = null;\n\n    // Status\n    this.connectionStatus = \"disconnected\"; // 'connecting', 'connected', 'disconnected', 'failed'\n  }\n\n  /**\n   * Get display name with role\n   */\n  getDisplayName() {\n    const roleText = this.role === \"owner\" ? \" (Host)\" : \"\";\n    const localText = this.isLocal ? \" (You)\" : \"\";\n    return `${this.userId}${roleText}${localText}`;\n  }\n\n  /**\n   * Toggle microphone (local only)\n   */\n  async toggleMicrophone() {\n    if (!this.isLocal || !this.publisher) return;\n\n    try {\n      await this.publisher.toggleMic();\n      this.isAudioEnabled = !this.isAudioEnabled;\n      this.emit(\"audioToggled\", {\n        participant: this,\n        enabled: this.isAudioEnabled,\n      });\n    } catch (error) {\n      this.emit(\"error\", {\n        participant: this,\n        error,\n        action: \"toggleMicrophone\",\n      });\n    }\n  }\n\n  /**\n   * Toggle camera (local only)\n   */\n  async toggleCamera() {\n    if (!this.isLocal || !this.publisher) return;\n\n    try {\n      await this.publisher.toggleCamera();\n      this.isVideoEnabled = !this.isVideoEnabled;\n      this.emit(\"videoToggled\", {\n        participant: this,\n        enabled: this.isVideoEnabled,\n      });\n    } catch (error) {\n      this.emit(\"error\", { participant: this, error, action: \"toggleCamera\" });\n    }\n  }\n\n  /**\n   * Toggle remote participant's audio\n   */\n  async toggleRemoteAudio() {\n    if (this.isLocal || !this.subscriber) return;\n\n    try {\n      await this.subscriber.toggleAudio();\n      this.isAudioEnabled = !this.isAudioEnabled;\n      this.emit(\"remoteAudioToggled\", {\n        participant: this,\n        enabled: this.isAudioEnabled,\n      });\n    } catch (error) {\n      this.emit(\"error\", {\n        participant: this,\n        error,\n        action: \"toggleRemoteAudio\",\n      });\n    }\n  }\n\n  /**\n   * Toggle pin status\n   */\n  togglePin() {\n    if (!this.isLocal) {\n      if (this.isPinned) {\n        this.subscriber?.switchBitrate(\"360p\");\n        console.warn(\"Unpin participant, switch to low quality\");\n      } else {\n        this.subscriber?.switchBitrate(\"720p\");\n        console.warn(\"Pin participant, switch to high quality\");\n      }\n    }\n\n    this.isPinned = !this.isPinned;\n    this.emit(\"pinToggled\", { participant: this, pinned: this.isPinned });\n  }\n\n  /**\n   * Toggle raise hand (local only)\n   */\n  async toggleRaiseHand() {\n    if (!this.isLocal || !this.publisher) return;\n\n    try {\n      if (this.isHandRaised) {\n        await this.publisher.lowerHand();\n      } else {\n        await this.publisher.raiseHand();\n      }\n      this.isHandRaised = !this.isHandRaised;\n      this.emit(\"handRaiseToggled\", {\n        participant: this,\n        enabled: this.isHandRaised,\n      });\n      console.log(\"toggleRaiseHand\", this.isHandRaised);\n\n    } catch (error) {\n      console.log(\"toggleRaiseHand error\", error);\n\n      this.emit(\"error\", {\n        participant: this,\n        error,\n        action: \"toggleRaiseHand\",\n      });\n    }\n  }\n\n  /**\n   * Update connection status\n   */\n  setConnectionStatus(status) {\n    this.connectionStatus = status;\n    this.emit(\"statusChanged\", { participant: this, status });\n  }\n\n  /**\n   * Get status text for display\n   */\n  _getStatusText(status) {\n    switch (status) {\n      case \"connecting\":\n        return \"Connecting...\";\n      case \"connected\":\n        return \"Connected\";\n      case \"disconnected\":\n        return \"Disconnected\";\n      case \"failed\":\n        return \"Connection Failed\";\n      default:\n        return status;\n    }\n  }\n\n  /**\n   * Set publisher instance\n   */\n  setPublisher(publisher) {\n    this.publisher = publisher;\n    if (publisher) {\n      this.setConnectionStatus(\"connected\");\n    }\n  }\n\n  /**\n   * Set subscriber instance\n   */\n  setSubscriber(subscriber) {\n    this.subscriber = subscriber;\n    if (subscriber) {\n      this.setConnectionStatus(\"connected\");\n    }\n  }\n\n  /**\n   * Update microphone status from server event\n   */\n  updateMicStatus(enabled) {\n    this.isAudioEnabled = enabled;\n    this.emit(\"remoteAudioStatusChanged\", {\n      participant: this,\n      enabled: this.isAudioEnabled,\n    });\n  }\n\n  /**\n   * Update camera status from server event\n   */\n  updateCameraStatus(enabled) {\n    this.isVideoEnabled = enabled;\n    this.emit(\"remoteVideoStatusChanged\", {\n      participant: this,\n      enabled: this.isVideoEnabled,\n    });\n  }\n\n  /**\n   * Update hand raise status from server event\n   */\n  updateHandRaiseStatus(enabled) {\n    this.isHandRaised = enabled;\n    this.emit(\"remoteHandRaisingStatusChanged\", {\n      participant: this,\n      enabled: this.isHandRaised,\n    });\n  }\n\n  /**\n   * Cleanup participant resources\n   */\n  cleanup() {\n    // Stop media streams\n    if (this.publisher) {\n      this.publisher.stop();\n      this.publisher = null;\n    }\n\n    if (this.subscriber) {\n      this.subscriber.stop();\n      this.subscriber = null;\n    }\n\n    // Stop screen subscriber\n    if (this.screenSubscriber) {\n      this.screenSubscriber.stop();\n      this.screenSubscriber = null;\n    }\n\n    this.setConnectionStatus(\"disconnected\");\n    this.removeAllListeners();\n\n    this.emit(\"cleanup\", { participant: this });\n  }\n\n  /**\n   * Get participant info\n   */\n  getInfo() {\n    return {\n      userId: this.userId,\n      streamId: this.streamId,\n      membershipId: this.membershipId,\n      role: this.role,\n      isLocal: this.isLocal,\n      isAudioEnabled: this.isAudioEnabled,\n      isVideoEnabled: this.isVideoEnabled,\n      isHandRaised: this.isHandRaised,\n      isPinned: this.isPinned,\n      isScreenSharing: this.isScreenSharing,\n      connectionStatus: this.connectionStatus,\n    };\n  }\n}\n\nexport default Participant;\n","import EventEmitter from \"../events/EventEmitter.js\";\n\n/**\n * WebRTC Publisher Class\n * Handles video/audio streaming via WebTransport\n */\nexport default class Publisher extends EventEmitter {\n  constructor(options = {}) {\n    super();\n\n    // Validate required options\n    if (!options.publishUrl) {\n      throw new Error(\"publishUrl is required\");\n    }\n\n    // Configuration\n    this.publishUrl = options.publishUrl;\n    this.streamType = options.streamType || \"camera\"; // 'camera' or 'display'\n    this.streamId = options.streamId || \"test_stream\";\n\n    // Video configuration\n    this.currentConfig = {\n      codec: \"avc1.640c34\",\n      width: options.width || 1280,\n      height: options.height || 720,\n      framerate: options.framerate || 30,\n      bitrate: options.bitrate || 1_500_000,\n    };\n\n    // Audio configuration\n    this.kSampleRate = 48000;\n    this.opusBaseTime = 0;\n    this.opusSamplesSent = 0;\n    this.opusSamplesPerChunk = 960; // 20ms at 48kHz\n    this.opusChunkCount = 0;\n\n    // State variables\n    this.stream = null;\n    this.audioProcessor = null;\n    this.videoProcessor = null;\n    this.webTransport = null;\n    this.isChannelOpen = false;\n    this.sequenceNumber = 0;\n    this.isPublishing = false;\n\n    this.cameraEnabled = true;\n    this.micEnabled = true;\n    this.isHandRaised = false;\n    this.hasCamera = options.hasCamera !== undefined ? options.hasCamera : true;\n    this.hasMic = options.hasMic !== undefined ? options.hasMic : true;\n\n    // Callbacks\n    this.onStatusUpdate =\n      options.onStatusUpdate || ((message, isError) => console.log(message));\n    this.onStreamStart = options.onStreamStart || (() => { });\n    this.onStreamStop = options.onStreamStop || (() => { });\n    this.onServerEvent = options.onServerEvent || ((event) => { });\n\n    // Initialize modules\n    this.wasmInitialized = false;\n    this.wasmInitializing = false;\n    this.wasmInitPromise = null;\n    this.initAudioRecorder = null;\n    this.WasmEncoder = null;\n\n    // Stream management\n    this.publishStreams = new Map(); // key: channelName, value: {writer, reader, configSent, config}\n    this.videoEncoders = new Map();\n    this.eventStream = null; // Dedicated event stream\n\n    this.subStreams = [\n      {\n        name: \"high\",\n        width: 1280,\n        height: 720,\n        bitrate: 800_000,\n        framerate: 30,\n        channelName: \"cam_720p\",\n      },\n      // {\n      //   name: \"low\",\n      //   width: 854,\n      //   height: 480,\n      //   bitrate: 500_000,\n      //   framerate: 30,\n      //   channelName: \"cam_360p\",\n      // },\n      {\n        name: \"low\",\n        width: 640,\n        height: 360,\n        bitrate: 400_000,\n        framerate: 30,\n        channelName: \"cam_360p\",\n      },\n      {\n        name: \"screen\",\n        width: 1920,\n        height: 1080,\n        bitrate: 2_000_000,\n        framerate: 30,\n        channelName: \"screen_share_1080p\",\n      },\n      {\n        name: \"microphone\",\n        channelName: \"mic_48k\",\n      },\n    ];\n  }\n\n  async init() {\n    await this.loadAllDependencies();\n    this.onStatusUpdate(\"Publisher initialized successfully\");\n  }\n\n  async loadAllDependencies() {\n    try {\n      if (\n        !document.querySelector('script[src*=\"MSTP_polyfill.js\"]')\n      ) {\n        await new Promise((resolve, reject) => {\n          const script = document.createElement(\"script\");\n          script.src = \"../polyfills/MSTP_polyfill.js\";\n          script.onload = () => resolve();\n          script.onerror = () =>\n            reject(new Error(\"Failed to load MSTP polyfill\"));\n          document.head.appendChild(script);\n        });\n        console.log(\"Polyfill loaded successfully\");\n      }\n\n      if (!this.wasmInitialized) {\n        if (this.wasmInitializing && this.wasmInitPromise) {\n          await this.wasmInitPromise;\n        } else {\n          this.wasmInitializing = true;\n          const { default: init, WasmEncoder } = await import(\n            \"../raptorQ/raptorq_wasm.js\"\n          );\n\n          this.WasmEncoder = WasmEncoder;\n\n          this.wasmInitPromise = init(\"../raptorQ/raptorq_wasm_bg.wasm\")\n            .then(() => {\n              this.wasmInitialized = true;\n              this.wasmInitializing = false;\n              console.log(\"WASM encoder module loaded successfully\");\n            })\n            .catch((err) => {\n              this.wasmInitializing = false;\n              console.error(\"Failed to load WASM encoder module:\", err);\n              throw new Error(\"Failed to load WASM encoder module\");\n            });\n\n          await this.wasmInitPromise;\n        }\n      }\n\n      const opusModule = await import(\n        `/opus_decoder/opusDecoder.js?t=${Date.now()}`\n      );\n      this.initAudioRecorder = opusModule.initAudioRecorder;\n      console.log(\"Opus decoder module loaded successfully\");\n\n      this.onStatusUpdate(\"All dependencies loaded successfully\");\n    } catch (error) {\n      this.onStatusUpdate(`Dependency loading error: ${error.message}`, true);\n      throw error;\n    }\n  }\n\n  async startPublishing() {\n    if (this.isPublishing) {\n      this.onStatusUpdate(\"Already publishing\", true);\n      return;\n    }\n    await this.init();\n\n    // Setup WebTransport connection\n    await this.setupConnection();\n\n    try {\n      // Get media stream based on type\n      await this.getMediaStream();\n      this.isPublishing = true;\n      // Start streaming\n      await this.startStreaming();\n\n      this.onStreamStart();\n      this.onStatusUpdate(\"Publishing started successfully\");\n    } catch (error) {\n      this.onStatusUpdate(`Failed to start publishing: ${error.message}`, true);\n      throw error;\n    }\n  }\n\n  // Toggle camera\n  async toggleCamera() {\n    if (this.cameraEnabled) {\n      await this.turnOffCamera();\n    } else {\n      await this.turnOnCamera();\n    }\n  }\n\n  // Toggle mic\n  async toggleMic() {\n    if (this.micEnabled) {\n      await this.turnOffMic();\n    } else {\n      await this.turnOnMic();\n    }\n  }\n\n  // Toggle raise hand\n  async toggleRaiseHand() {\n    const currentState = this.isHandRaised || false;\n\n    if (currentState) {\n      await this.lowerHand();\n      this.isHandRaised = false;\n    } else {\n      await this.raiseHand();\n      this.isHandRaised = true;\n    }\n\n    return this.isHandRaised;\n  }\n\n  // Turn off camera (stop encoding video frames)\n  async turnOffCamera() {\n    if (!this.cameraEnabled) return;\n\n    this.cameraEnabled = false;\n    this.onStatusUpdate(\"Camera turned off\");\n\n    // Send camera_off event to server\n    await this.sendMeetingEvent(\"camera_off\");\n  }\n\n  // Turn on camera (resume encoding video frames)\n  async turnOnCamera() {\n    if (this.cameraEnabled) return;\n\n    this.cameraEnabled = true;\n    this.onStatusUpdate(\"Camera turned on\");\n\n    // Send camera_on event to server\n    await this.sendMeetingEvent(\"camera_on\");\n  }\n\n  // Turn off mic (stop encoding audio chunks)\n  async turnOffMic() {\n    if (!this.micEnabled) return;\n\n    this.micEnabled = false;\n    this.onStatusUpdate(\"Mic turned off\");\n\n    // Send mic_off event to server\n    await this.sendMeetingEvent(\"mic_off\");\n  }\n\n  // Turn on mic (resume encoding audio chunks)\n  async turnOnMic() {\n    if (this.micEnabled) return;\n\n    this.micEnabled = true;\n    this.onStatusUpdate(\"Mic turned on\");\n\n    // Send mic_on event to server\n    await this.sendMeetingEvent(\"mic_on\");\n  }\n  async pinForEveryone(targetStreamId) {\n    await this.sendMeetingEvent(\"pin_for_everyone\", targetStreamId);\n  }\n  async unpinForEveryone(targetStreamId) {\n    await this.sendMeetingEvent(\"unpin_for_everyone\", targetStreamId);\n  }\n\n  // Raise hand\n  async raiseHand() {\n    if (this.isHandRaised) return;\n\n    this.isHandRaised = true;\n    await this.sendMeetingEvent(\"raise_hand\");\n    this.onStatusUpdate(\"Hand raised\");\n  }\n\n  // Lower hand\n  async lowerHand() {\n    if (!this.isHandRaised) return;\n\n    this.isHandRaised = false;\n    await this.sendMeetingEvent(\"lower_hand\");\n    this.onStatusUpdate(\"Hand lowered\");\n  }\n\n  /**\n   * Send meeting control event to server\n   */\n  async sendMeetingEvent(eventType, targetStreamId = null) {\n    if (!eventType) return;\n\n    if (!this.isChannelOpen || !this.eventStream) {\n      console.warn(`Skipping ${eventType} event: Event stream not ready`);\n      return;\n    }\n    console.log(\"[Meeting Event] Sender stream ID:\", this.streamId);\n\n    const eventMessage = {\n      type: eventType,\n      sender_stream_id: this.streamId,\n      timestamp: Date.now(),\n    };\n\n    if (\n      (eventType === \"pin_for_everyone\" ||\n        eventType === \"unpin_for_everyone\") &&\n      targetStreamId\n    ) {\n      eventMessage.target_stream_id = targetStreamId;\n    }\n\n    try {\n      await this.sendEvent(eventMessage);\n      console.log(`Sent meeting event:`, eventMessage);\n    } catch (error) {\n      console.error(`Failed to send meeting event ${eventType}:`, error);\n      this.onStatusUpdate(`Failed to notify server about ${eventType}`, true);\n    }\n  }\n\n  async getMediaStream() {\n    if (this.streamType === \"camera\") {\n      const constraints = {\n        audio: {\n          sampleRate: this.kSampleRate,\n          channelCount: 1,\n          echoCancellation: true,\n          noiseSuppression: true,\n        },\n        video: {\n          width: { ideal: this.currentConfig.width },\n          height: { ideal: this.currentConfig.height },\n          frameRate: { ideal: this.currentConfig.framerate },\n        },\n      };\n      try {\n        this.stream = await navigator.mediaDevices.getUserMedia(constraints);\n      } catch (error) {\n        console.error(\"Error accessing media devices:\", error);\n      }\n    } else if (this.streamType === \"display\") {\n      this.stream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n        audio: true,\n      });\n\n      // Handle user stopping screen share via browser UI\n      const videoTrack = this.stream.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.onended = () => {\n          this.stop();\n        };\n      }\n    }\n\n    // Create video-only stream for display\n    const videoOnlyStream = new MediaStream();\n    const videoTracks = this.stream.getVideoTracks();\n\n    if (videoTracks.length > 0) {\n      videoOnlyStream.addTrack(videoTracks[0]);\n    }\n\n    // Emit local stream ready event for app integration\n    this.emit(\"localStreamReady\", {\n      stream: this.stream,           // Full stream with audio + video\n      videoOnlyStream: videoOnlyStream, // Video only stream\n      streamType: this.streamType,\n      streamId: this.streamId,\n      config: this.currentConfig\n    });\n    this.onStatusUpdate(`${this.streamType} stream ready`);\n  }\n\n  initVideoEncoders() {\n    this.subStreams.forEach((subStream) => {\n      if (!subStream.channelName.startsWith(\"mic\")) {\n        console.log(`Setting up encoder for ${subStream.name}`);\n        const encoder = new VideoEncoder({\n          output: (chunk, metadata) =>\n            this.handleVideoChunk(\n              chunk,\n              metadata,\n              subStream.name,\n              subStream.channelName\n            ),\n          error: (e) =>\n            this.onStatusUpdate(\n              `Encoder ${subStream.name} error: ${e.message}`,\n              true\n            ),\n        });\n\n        this.videoEncoders.set(subStream.name, {\n          encoder,\n          channelName: subStream.channelName,\n          config: {\n            codec: this.currentConfig.codec,\n            width: subStream.width,\n            height: subStream.height,\n            bitrate: subStream.bitrate,\n            framerate: this.currentConfig.framerate,\n            latencyMode: \"realtime\",\n            hardwareAcceleration: \"prefer-hardware\",\n          },\n          metadataReady: false,\n          videoDecoderConfig: null,\n        });\n      }\n    });\n  }\n\n  async setupConnection() {\n    this.webTransport = new WebTransport(this.publishUrl);\n    await this.webTransport.ready;\n    console.log(\"WebTransport connected to server\");\n\n    await this.createEventStream();\n\n    for (const subStream of this.subStreams) {\n      if (!subStream.channelName.startsWith(\"screen\")) {\n        await this.createBidirectionalStream(subStream.channelName);\n      }\n    }\n\n    this.isChannelOpen = true;\n    this.onStatusUpdate(\n      \"WebTransport connection established with event stream and media streams\"\n    );\n  }\n\n  async createEventStream() {\n    const stream = await this.webTransport.createBidirectionalStream();\n    const readable = stream.readable;\n    const writable = stream.writable;\n\n    const writer = writable.getWriter();\n    const reader = readable.getReader();\n\n    this.eventStream = { writer, reader };\n\n    console.log(\"WebTransport event stream established\");\n\n    const initData = new TextEncoder().encode(\"meeting_control\");\n    await this.sendOverEventStream(initData);\n\n    // Setup reader cho event stream\n    this.setupEventStreamReader(reader);\n\n    await this.sendPublisherState();\n\n    const workerInterval = new Worker(\"polyfills/intervalWorker.js\");\n    workerInterval.postMessage({ interval: 1000 });\n    let lastPingTime = Date.now();\n\n    workerInterval.onmessage = (e) => {\n      const ping = new TextEncoder().encode(\"ping\");\n      this.sendOverEventStream(ping);\n      if (Date.now() - lastPingTime > 1200) {\n        console.warn(\"Ping delay detected, connection may be unstable\");\n      }\n      lastPingTime = Date.now();\n    };\n\n    // setInterval(() => {\n    //   const ping = new TextEncoder().encode(\"ping\");\n    //   this.sendOverEventStream(ping);\n    //   console.log(\"Ping sent to server\");\n    // }, 500);\n  }\n\n  setupEventStreamReader(reader) {\n    (async () => {\n      try {\n        while (true) {\n          const { value, done } = await reader.read();\n          if (done) {\n            console.log(\"Event stream closed by server\");\n            break;\n          }\n          if (value) {\n            const msg = new TextDecoder().decode(value);\n            try {\n              const event = JSON.parse(msg);\n              this.onServerEvent(event);\n            } catch (e) {\n              console.log(\"Non-JSON event message:\", msg);\n            }\n          }\n        }\n      } catch (err) {\n        console.error(\"Error reading from event stream:\", err);\n      }\n    })();\n  }\n\n  async sendOverEventStream(data) {\n    if (!this.eventStream) {\n      console.error(\"Event stream not available\");\n      return;\n    }\n\n    try {\n      const bytes =\n        typeof data === \"string\" ? new TextEncoder().encode(data) : data;\n\n      const len = bytes.length;\n      const out = new Uint8Array(4 + len);\n      const view = new DataView(out.buffer);\n      view.setUint32(0, len, false);\n      out.set(bytes, 4);\n      await this.eventStream.writer.write(out);\n    } catch (error) {\n      console.error(\"Failed to send over event stream:\", error);\n      throw error;\n    }\n  }\n\n  async sendEvent(eventData) {\n    const eventJson = JSON.stringify(eventData);\n    await this.sendOverEventStream(eventJson);\n  }\n\n  async sendPublisherState() {\n    const stateEvent = {\n      type: \"PublisherState\",\n      streamId: this.streamId,\n      hasCamera: this.hasCamera,\n      hasMic: this.hasMic,\n      cameraEnabled: this.hasCamera ? this.cameraEnabled : false,\n      micEnabled: this.hasMic ? this.micEnabled : false,\n      streamType: this.streamType, // 'camera' or 'display'\n      timestamp: Date.now(),\n    };\n\n    await this.sendEvent(stateEvent);\n    this.onStatusUpdate(\"Publisher state sent to server\");\n  }\n\n  async createBidirectionalStream(channelName) {\n    const stream = await this.webTransport.createBidirectionalStream();\n    const readable = stream.readable;\n    const writable = stream.writable;\n\n    const writer = writable.getWriter();\n    const reader = readable.getReader();\n\n    this.publishStreams.set(channelName, {\n      writer,\n      reader,\n      configSent: false,\n      config: null,\n    });\n\n    console.log(\n      `WebTransport bidirectional stream (${channelName}) established`\n    );\n\n    const initData = new TextEncoder().encode(channelName);\n    await this.sendOverStream(channelName, initData);\n\n    this.setupStreamReader(channelName, reader);\n\n    console.log(`Stream created: ${channelName}`);\n  }\n\n  setupStreamReader(channelName, reader) {\n    (async () => {\n      try {\n        while (true) {\n          const { value, done } = await reader.read();\n          if (done) {\n            console.log(`Stream ${channelName} closed by server`);\n            break;\n          }\n          if (value) {\n            const msg = new TextDecoder().decode(value);\n            if (msg.startsWith(\"ack:\") || msg.startsWith(\"config:\")) {\n              console.log(`${channelName} received:`, msg);\n            }\n          }\n        }\n      } catch (err) {\n        console.error(`Error reading from stream ${channelName}:`, err);\n      }\n    })();\n  }\n\n  async sendOverStream(channelName, frameBytes) {\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData) {\n      console.error(`Stream ${channelName} not found`);\n      return;\n    }\n\n    try {\n      const len = frameBytes.length;\n      const out = new Uint8Array(4 + len);\n      const view = new DataView(out.buffer);\n      view.setUint32(0, len, false);\n      out.set(frameBytes, 4);\n      await streamData.writer.write(out);\n    } catch (error) {\n      console.error(`Failed to send over stream ${channelName}:`, error);\n      throw error;\n    }\n  }\n\n  async startStreaming() {\n    // Start video capture\n    await this.startVideoCapture();\n\n    // Start audio streaming\n    this.audioProcessor = await this.startOpusAudioStreaming();\n  }\n\n  async startVideoCapture() {\n    if (!this.stream) {\n      throw new Error(\"No media stream available\");\n    }\n\n    this.initVideoEncoders();\n\n    this.videoEncoders.forEach((encoderObj) => {\n      console.log(\n        `Configuring encoder for ${encoderObj.channelName}`,\n        encoderObj,\n        \"config\",\n        encoderObj.config\n      );\n      encoderObj.encoder.configure(encoderObj.config);\n    });\n\n    const triggerWorker = new Worker(\"polyfills/triggerWorker.js\");\n    triggerWorker.postMessage({ frameRate: this.currentConfig.framerate });\n\n    const track = this.stream.getVideoTracks()[0];\n    console.log(\"Using video track:\", track);\n    this.videoProcessor = new MediaStreamTrackProcessor(\n      track,\n      triggerWorker,\n      true\n    );\n\n    const reader = this.videoProcessor.readable.getReader();\n    console.log(\"Video processor reader created:\", reader);\n\n    let frameCounter = 0;\n\n    const cameraEncoders = Array.from(this.videoEncoders.entries()).filter(\n      ([_, obj]) => obj.channelName.startsWith(\"cam\")\n    );\n\n    // Process video frames\n    (async () => {\n      try {\n        while (this.isPublishing) {\n          const result = await reader.read();\n\n          if (result.done) break;\n\n          const frame = result.value;\n\n          if (!window.videoBaseTimestamp) {\n            window.videoBaseTimestamp = frame.timestamp;\n          }\n\n          if (!this.cameraEnabled) {\n            console.log(\"Camera disabled, skipping frame\");\n            frame.close();\n            continue;\n          }\n\n          frameCounter++;\n          const keyFrame = frameCounter % 30 === 0;\n\n          for (let i = 0; i < cameraEncoders.length; i++) {\n            const [quality, encoderObj] = cameraEncoders[i];\n            const isLastEncoder = i === cameraEncoders.length - 1;\n\n            if (encoderObj.encoder.encodeQueueSize <= 2) {\n              const frameToEncode = isLastEncoder\n                ? frame\n                : new VideoFrame(frame);\n              encoderObj.encoder.encode(frameToEncode, { keyFrame });\n              frameToEncode.close();\n            }\n          }\n        }\n      } catch (error) {\n        this.onStatusUpdate(`Video processing error: ${error.message}`, true);\n        console.error(\"Video capture error:\", error);\n      }\n    })();\n  }\n\n  async startOpusAudioStreaming() {\n    if (!this.stream) {\n      throw new Error(\"No media stream available\");\n    }\n\n    const audioTrack = this.stream.getAudioTracks()[0];\n    if (!audioTrack) {\n      throw new Error(\"No audio track found in stream\");\n    }\n\n    const audioRecorderOptions = {\n      encoderApplication: 2051,\n      encoderComplexity: 0,\n      encoderFrameSize: 20,\n      timeSlice: 100,\n    };\n\n    const audioRecorder = await this.initAudioRecorder(\n      audioTrack,\n      audioRecorderOptions\n    );\n    audioRecorder.ondataavailable = (typedArray) =>\n      this.handleOpusAudioChunk(typedArray, \"mic_48k\");\n\n    await audioRecorder.start({\n      timeSlice: audioRecorderOptions.timeSlice,\n    });\n\n    return audioRecorder;\n  }\n\n  handleVideoChunk(chunk, metadata, quality, channelName) {\n    const encoderObj = this.videoEncoders.get(quality);\n    if (!encoderObj) return;\n\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData) return;\n\n    if (metadata && metadata.decoderConfig && !encoderObj.metadataReady) {\n      encoderObj.videoDecoderConfig = {\n        codec: metadata.decoderConfig.codec,\n        codedWidth: metadata.decoderConfig.codedWidth,\n        codedHeight: metadata.decoderConfig.codedHeight,\n        frameRate: this.currentConfig.framerate,\n        description: metadata.decoderConfig.description,\n      };\n      encoderObj.metadataReady = true;\n      console.warn(\n        \"Video config ready for\",\n        channelName,\n        encoderObj.videoDecoderConfig\n      );\n      this.sendStreamConfig(\n        channelName,\n        encoderObj.videoDecoderConfig,\n        \"video\"\n      );\n    }\n\n    if (!streamData.configSent) return;\n\n    const chunkData = new ArrayBuffer(chunk.byteLength);\n    chunk.copyTo(chunkData);\n    let type;\n    switch (channelName) {\n      case \"cam_360p\":\n        type = chunk.type === \"key\" ? 0 : 1;\n        break;\n      case \"cam_720p\":\n        type = chunk.type === \"key\" ? 2 : 3;\n        break;\n      case \"screen_share_1080p\":\n        type = chunk.type === \"key\" ? 4 : 5;\n        break;\n      default:\n        type = 8; // other\n    }\n    // const type = chunk.type === \"key\" ? \"video-key\" : \"video-delta\";\n\n    const packet = this.createPacketWithHeader(\n      chunkData,\n      chunk.timestamp,\n      type\n    );\n\n    this.sendOverStream(channelName, packet);\n    this.sequenceNumber++;\n  }\n\n  handleOpusAudioChunk(typedArray, channelName) {\n    if (!this.micEnabled) return;\n    if (!this.isChannelOpen || !typedArray || typedArray.byteLength === 0)\n      return;\n\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData) return;\n\n    try {\n      const dataArray = new Uint8Array(typedArray);\n      // Check for Opus header \"OggS\"\n      if (\n        dataArray.length >= 4 &&\n        dataArray[0] === 79 &&\n        dataArray[1] === 103 &&\n        dataArray[2] === 103 &&\n        dataArray[3] === 83\n      ) {\n        if (!streamData.configSent && !streamData.config) {\n          const description = this.createPacketWithHeader(\n            dataArray,\n            performance.now() * 1000,\n            6\n          );\n\n          const audioConfig = {\n            codec: \"opus\",\n            sampleRate: 48000,\n            numberOfChannels: 1,\n            description: description,\n          };\n\n          streamData.config = audioConfig;\n          this.sendStreamConfig(channelName, audioConfig, \"audio\");\n        }\n\n        // Initialize timing\n        if (this.opusBaseTime === 0 && window.videoBaseTimestamp) {\n          this.opusBaseTime = window.videoBaseTimestamp;\n          window.audioStartPerfTime = performance.now();\n          this.opusSamplesSent = 0;\n          this.opusChunkCount = 0;\n        } else if (this.opusBaseTime === 0 && !window.videoBaseTimestamp) {\n          this.opusBaseTime = performance.now() * 1000;\n          this.opusSamplesSent = 0;\n          this.opusChunkCount = 0;\n        }\n\n        const timestamp =\n          this.opusBaseTime +\n          Math.floor((this.opusSamplesSent * 1000000) / this.kSampleRate);\n\n        if (streamData.configSent) {\n          const packet = this.createPacketWithHeader(dataArray, timestamp, 6);\n\n          this.sendOverStream(channelName, packet);\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to send audio data:\", error);\n    }\n  }\n\n  async sendStreamConfig(channelName, config, mediaType) {\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData || streamData.configSent) return;\n\n    try {\n      let configPacket;\n\n      if (mediaType === \"video\") {\n        const vConfigUint8 = new Uint8Array(config.description);\n        const vConfigBase64 = this.uint8ArrayToBase64(vConfigUint8);\n\n        configPacket = {\n          type: \"StreamConfig\",\n          channelName: channelName,\n          mediaType: \"video\",\n          config: {\n            codec: config.codec,\n            codedWidth: config.codedWidth,\n            codedHeight: config.codedHeight,\n            frameRate: config.frameRate,\n            quality: config.quality,\n            description: vConfigBase64,\n          },\n        };\n      } else if (mediaType === \"audio\") {\n        const aConfigBase64 = this.uint8ArrayToBase64(\n          new Uint8Array(config.description)\n        );\n\n        configPacket = {\n          type: \"StreamConfig\",\n          channelName: channelName,\n          mediaType: \"audio\",\n          config: {\n            codec: config.codec,\n            sampleRate: config.sampleRate,\n            numberOfChannels: config.numberOfChannels,\n            description: aConfigBase64,\n          },\n        };\n      }\n      console.log(\"send stream config\", configPacket);\n      const packet = new TextEncoder().encode(JSON.stringify(configPacket));\n      await this.sendOverStream(channelName, packet);\n\n      streamData.configSent = true;\n      streamData.config = config;\n\n      this.onStatusUpdate(`Config sent for stream: ${channelName}`);\n    } catch (error) {\n      console.error(`Failed to send config for ${channelName}:`, error);\n    }\n  }\n\n  createPacketWithHeader(data, timestamp, type) {\n    let adjustedTimestamp = timestamp;\n    if (window.videoBaseTimestamp) {\n      adjustedTimestamp = timestamp - window.videoBaseTimestamp;\n    }\n\n    let safeTimestamp = Math.floor(adjustedTimestamp / 1000);\n    if (safeTimestamp < 0) safeTimestamp = 0;\n\n    const HEADER_SIZE = 5;\n    const MAX_TS = 0xffffffff;\n    const MIN_TS = 0;\n\n    if (safeTimestamp > MAX_TS) safeTimestamp = MAX_TS;\n    if (safeTimestamp < MIN_TS) safeTimestamp = MIN_TS;\n\n    const packet = new Uint8Array(\n      HEADER_SIZE +\n      (data instanceof ArrayBuffer ? data.byteLength : data.length)\n    );\n    // type mapping\n    // video-360p-key = 0\n    // video-360p-delta = 1\n    // video-720p-key = 2\n    // video-720p-delta = 3\n    // video-1080p-key = 4\n    // video-1080p-delta = 5\n    // audio = 6\n    // config = 7\n    // other = 8\n\n    packet[4] = type;\n\n    const view = new DataView(packet.buffer, 0, 4);\n    view.setUint32(0, safeTimestamp, false);\n\n    packet.set(\n      data instanceof ArrayBuffer ? new Uint8Array(data) : data,\n      HEADER_SIZE\n    );\n\n    return packet;\n  }\n\n  uint8ArrayToBase64(bytes) {\n    let binary = \"\";\n    const chunkSize = 0x8000;\n    for (let i = 0; i < bytes.length; i += chunkSize) {\n      const chunk = bytes.subarray(i, i + chunkSize);\n      binary += String.fromCharCode.apply(null, chunk);\n    }\n    return btoa(binary);\n  }\n\n  /**\n   * Start screen sharing\n   */\n  async startShareScreen(stream) {\n    if (!stream) {\n      throw new Error(\"No stream provided for screen sharing\");\n    }\n\n    this.screenStream = stream;\n    this.isScreenSharing = true;\n\n    const channelName = \"screen_share_1080p\";\n\n    try {\n      // Create WebTransport stream for screen share\n      await this.createBidirectionalStream(channelName);\n\n      // Send start_share_screen event\n      const startEvent = {\n        type: \"start_share_screen\",\n        sender_stream_id: this.streamId,\n      };\n      await this.sendEvent(startEvent);\n\n      const videoTrack = stream.getVideoTracks()[0];\n      const audioTrack = stream.getAudioTracks()[0];\n\n      if (!videoTrack) {\n        throw new Error(\"No video track found in screen share stream\");\n      }\n\n      // Setup screen share video encoder\n      const screenConfig = this.subStreams.find(\n        (s) => s.channelName === channelName\n      );\n\n      const screenEncoder = new VideoEncoder({\n        output: (chunk, metadata) =>\n          this.handleScreenVideoChunk(chunk, metadata, channelName),\n        error: (e) =>\n          this.onStatusUpdate(`Screen encoder error: ${e.message}`, true),\n      });\n\n      const encoderConfig = {\n        codec: this.currentConfig.codec,\n        width: screenConfig.width,\n        height: screenConfig.height,\n        bitrate: screenConfig.bitrate,\n        framerate: screenConfig.framerate,\n        latencyMode: \"realtime\",\n        hardwareAcceleration: \"prefer-hardware\",\n      };\n\n      screenEncoder.configure(encoderConfig);\n\n      this.screenVideoEncoder = {\n        encoder: screenEncoder,\n        config: encoderConfig,\n        metadataReady: false,\n        videoDecoderConfig: null,\n      };\n\n      // Setup screen share audio if available\n      if (audioTrack) {\n        const audioRecorderOptions = {\n          encoderApplication: 2051,\n          encoderComplexity: 0,\n          encoderFrameSize: 20,\n          timeSlice: 100,\n        };\n\n        this.screenAudioRecorder = await this.initAudioRecorder(\n          audioTrack,\n          audioRecorderOptions\n        );\n\n        this.screenAudioRecorder.ondataavailable = (typedArray) =>\n          this.handleScreenAudioChunk(typedArray, channelName);\n\n        await this.screenAudioRecorder.start({\n          timeSlice: audioRecorderOptions.timeSlice,\n        });\n\n        this.screenAudioBaseTime = 0;\n        this.screenAudioSamplesSent = 0;\n      }\n\n      // Start video processing\n      const triggerWorker = new Worker(\"polyfills/triggerWorker.js\");\n      triggerWorker.postMessage({ frameRate: screenConfig.framerate });\n\n      this.screenVideoProcessor = new MediaStreamTrackProcessor(\n        videoTrack,\n        triggerWorker,\n        true\n      );\n\n      const reader = this.screenVideoProcessor.readable.getReader();\n      let frameCounter = 0;\n\n      // Handle video track ending\n      videoTrack.onended = () => {\n        this.stopShareScreen();\n      };\n\n      // Process screen share video frames\n      (async () => {\n        try {\n          while (this.isScreenSharing) {\n            const result = await reader.read();\n            if (result.done) break;\n\n            const frame = result.value;\n\n            if (!window.screenBaseTimestamp) {\n              window.screenBaseTimestamp = frame.timestamp;\n            }\n\n            frameCounter++;\n            const keyFrame = frameCounter % 30 === 0;\n\n            if (this.screenVideoEncoder.encoder.encodeQueueSize <= 2) {\n              this.screenVideoEncoder.encoder.encode(frame, { keyFrame });\n            }\n\n            frame.close();\n          }\n        } catch (error) {\n          this.onStatusUpdate(\n            `Screen share video error: ${error.message}`,\n            true\n          );\n          console.error(\"Screen share video error:\", error);\n        }\n      })();\n\n      this.onStatusUpdate(\"Screen sharing started\");\n    } catch (error) {\n      this.onStatusUpdate(\n        `Failed to start screen share: ${error.message}`,\n        true\n      );\n      this.stopShareScreen();\n      throw error;\n    }\n  }\n\n  /**\n   * Stop screen sharing\n   */\n  async stopShareScreen() {\n    if (!this.isScreenSharing) {\n      return;\n    }\n\n    try {\n      this.isScreenSharing = false;\n\n      const channelName = \"screen_share_1080p\";\n\n      // Send stop event to server\n      const stopEvent = {\n        type: \"stop_share_screen\",\n        sender_stream_id: this.streamId,\n      };\n      await this.sendEvent(stopEvent);\n\n      // Stop and close video encoder\n      if (this.screenVideoEncoder && this.screenVideoEncoder.encoder) {\n        if (this.screenVideoEncoder.encoder.state !== \"closed\") {\n          await this.screenVideoEncoder.encoder.flush();\n          this.screenVideoEncoder.encoder.close();\n        }\n        this.screenVideoEncoder = null;\n      }\n\n      // Stop audio recorder\n      if (\n        this.screenAudioRecorder &&\n        typeof this.screenAudioRecorder.stop === \"function\"\n      ) {\n        await this.screenAudioRecorder.stop();\n        this.screenAudioRecorder = null;\n      }\n\n      // Close screen share stream\n      const streamData = this.publishStreams.get(channelName);\n      if (streamData && streamData.writer) {\n        await streamData.writer.close();\n        this.publishStreams.delete(channelName);\n      }\n\n      // Stop all tracks in screen stream\n      if (this.screenStream) {\n        this.screenStream.getTracks().forEach((track) => track.stop());\n        this.screenStream = null;\n      }\n\n      // Reset state\n      this.screenAudioBaseTime = 0;\n      this.screenAudioSamplesSent = 0;\n      this.screenAudioConfig = null;\n      window.screenBaseTimestamp = null;\n\n      this.onStatusUpdate(\"Screen sharing stopped\");\n    } catch (error) {\n      this.onStatusUpdate(\n        `Error stopping screen share: ${error.message}`,\n        true\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Handle screen share video chunks\n   */\n  handleScreenVideoChunk(chunk, metadata, channelName) {\n    if (!this.screenVideoEncoder) return;\n\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData) return;\n\n    // Handle metadata\n    if (\n      metadata &&\n      metadata.decoderConfig &&\n      !this.screenVideoEncoder.metadataReady\n    ) {\n      this.screenVideoEncoder.videoDecoderConfig = {\n        codec: metadata.decoderConfig.codec,\n        codedWidth: metadata.decoderConfig.codedWidth,\n        codedHeight: metadata.decoderConfig.codedHeight,\n        frameRate: this.screenVideoEncoder.config.framerate,\n        description: metadata.decoderConfig.description,\n      };\n      this.screenVideoEncoder.metadataReady = true;\n\n      console.log(\n        \"Screen video config ready:\",\n        this.screenVideoEncoder.videoDecoderConfig\n      );\n\n      this.sendScreenDecoderConfigs(channelName);\n    }\n\n    if (!streamData.configSent) return;\n\n    const chunkData = new ArrayBuffer(chunk.byteLength);\n    chunk.copyTo(chunkData);\n    const type = chunk.type === \"key\" ? 4 : 5; // screen_share_1080p key/delta\n\n    const packet = this.createPacketWithHeader(\n      chunkData,\n      chunk.timestamp,\n      type\n    );\n\n    this.sendOverStream(channelName, packet);\n  }\n\n  /**\n   * Handle screen share audio chunks\n   */\n  handleScreenAudioChunk(typedArray, channelName) {\n    if (!this.isScreenSharing || !typedArray || typedArray.byteLength === 0)\n      return;\n\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData) return;\n\n    try {\n      const dataArray = new Uint8Array(typedArray);\n\n      // Check for Opus header\n      if (\n        dataArray.length >= 4 &&\n        dataArray[0] === 79 &&\n        dataArray[1] === 103 &&\n        dataArray[2] === 103 &&\n        dataArray[3] === 83\n      ) {\n        if (!this.screenAudioConfig) {\n          const description = this.createPacketWithHeader(\n            dataArray,\n            performance.now() * 1000,\n            6\n          );\n\n          this.screenAudioConfig = {\n            codec: \"opus\",\n            sampleRate: 48000,\n            numberOfChannels: 2,\n            description: description,\n          };\n\n          console.log(\"Screen audio config ready:\", this.screenAudioConfig);\n          this.sendScreenDecoderConfigs(channelName);\n        }\n\n        // Initialize timing\n        if (this.screenAudioBaseTime === 0 && window.screenBaseTimestamp) {\n          this.screenAudioBaseTime = window.screenBaseTimestamp;\n          this.screenAudioSamplesSent = 0;\n        } else if (\n          this.screenAudioBaseTime === 0 &&\n          !window.screenBaseTimestamp\n        ) {\n          this.screenAudioBaseTime = performance.now() * 1000;\n          this.screenAudioSamplesSent = 0;\n        }\n\n        const timestamp =\n          this.screenAudioBaseTime +\n          Math.floor((this.screenAudioSamplesSent * 1000000) / 48000);\n\n        if (streamData.configSent) {\n          const packet = this.createPacketWithHeader(dataArray, timestamp, 6);\n          this.sendOverStream(channelName, packet);\n        }\n\n        this.screenAudioSamplesSent += 960;\n      }\n    } catch (error) {\n      console.error(\"Failed to send screen audio data:\", error);\n    }\n  }\n\n  /**\n   * Send screen share decoder configs\n   */\n  async sendScreenDecoderConfigs(channelName) {\n    const streamData = this.publishStreams.get(channelName);\n    if (!streamData || streamData.configSent) return;\n\n    const hasAudio = this.screenAudioRecorder !== null;\n    const videoReady =\n      this.screenVideoEncoder && this.screenVideoEncoder.metadataReady;\n    const audioReady = !hasAudio || this.screenAudioConfig;\n\n    if (!videoReady || !audioReady) {\n      return;\n    }\n\n    try {\n      const vConfigUint8 = new Uint8Array(\n        this.screenVideoEncoder.videoDecoderConfig.description\n      );\n      const vConfigBase64 = this.uint8ArrayToBase64(vConfigUint8);\n\n      const config = {\n        type: \"DecoderConfigs\",\n        channelName: channelName,\n        videoConfig: {\n          codec: this.screenVideoEncoder.videoDecoderConfig.codec,\n          codedWidth: this.screenVideoEncoder.videoDecoderConfig.codedWidth,\n          codedHeight: this.screenVideoEncoder.videoDecoderConfig.codedHeight,\n          frameRate: this.screenVideoEncoder.videoDecoderConfig.frameRate,\n          description: vConfigBase64,\n        },\n      };\n\n      if (this.screenAudioConfig) {\n        const aConfigBase64 = this.uint8ArrayToBase64(\n          new Uint8Array(this.screenAudioConfig.description)\n        );\n\n        config.audioConfig = {\n          codec: this.screenAudioConfig.codec,\n          sampleRate: this.screenAudioConfig.sampleRate,\n          numberOfChannels: this.screenAudioConfig.numberOfChannels,\n          description: aConfigBase64,\n        };\n      }\n\n      console.log(\"Sending screen share decoder configs:\", config);\n      const packet = new TextEncoder().encode(JSON.stringify(config));\n      await this.sendOverStream(channelName, packet);\n\n      streamData.configSent = true;\n      this.onStatusUpdate(`Screen share configs sent for: ${channelName}`);\n    } catch (error) {\n      console.error(`Failed to send screen share configs:`, error);\n    }\n  }\n\n  async stop() {\n    if (!this.isPublishing) {\n      return;\n    }\n\n    try {\n      this.isPublishing = false;\n\n      // Stop screen sharing if active\n      if (this.isScreenSharing) {\n        await this.stopShareScreen();\n      }\n\n      // Close video encoders\n      for (const [quality, encoderObj] of this.videoEncoders) {\n        if (encoderObj.encoder && encoderObj.encoder.state !== \"closed\") {\n          await encoderObj.encoder.flush();\n          encoderObj.encoder.close();\n        }\n      }\n      this.videoEncoders.clear();\n\n      // Stop audio processor\n      if (\n        this.audioProcessor &&\n        typeof this.audioProcessor.stop === \"function\"\n      ) {\n        await this.audioProcessor.stop();\n        this.audioProcessor = null;\n      }\n\n      // Close all streams\n      for (const [channelName, streamData] of this.publishStreams) {\n        if (streamData.writer) {\n          await streamData.writer.close();\n        }\n      }\n      this.publishStreams.clear();\n\n      // Close event stream\n      if (this.eventStream && this.eventStream.writer) {\n        await this.eventStream.writer.close();\n        this.eventStream = null;\n      }\n\n      // Close WebTransport\n      if (this.webTransport) {\n        this.webTransport.close();\n        this.webTransport = null;\n      }\n\n      // Stop all tracks\n      if (this.stream) {\n        this.stream.getTracks().forEach((track) => track.stop());\n        this.stream = null;\n      }\n\n      // Reset state\n      this.isChannelOpen = false;\n      this.sequenceNumber = 0;\n      this.opusBaseTime = 0;\n      this.opusSamplesSent = 0;\n      this.opusChunkCount = 0;\n\n      // Clear global variables\n      window.videoBaseTimestamp = null;\n      window.audioStartPerfTime = null;\n\n      this.onStreamStop();\n      this.onStatusUpdate(\"Publishing stopped\");\n    } catch (error) {\n      this.onStatusUpdate(`Error stopping publishing: ${error.message}`, true);\n      throw error;\n    }\n  }\n\n  // Getters for state\n  get isActive() {\n    return this.isPublishing;\n  }\n\n  get streamInfo() {\n    return {\n      streamType: this.streamType,\n      config: this.currentConfig,\n      sequenceNumber: this.sequenceNumber,\n      activeStreams: Array.from(this.publishStreams.keys()),\n    };\n  }\n}\n","import EventEmitter from \"../events/EventEmitter.js\";\n\n/**\n * Enhanced Subscriber class for receiving media streams\n * Refactored from EnhancedSubscriber with better structure\n */\nclass Subscriber extends EventEmitter {\n  constructor(config) {\n    super();\n\n    // Configuration\n    this.streamId = config.streamId || \"\";\n    this.roomId = config.roomId || \"\";\n    this.host = config.host || \"stream-gate.bandia.vn\";\n    this.isOwnStream = config.isOwnStream || false;\n\n    // Media configuration\n    this.mediaWorkerUrl = config.mediaWorkerUrl || \"workers/media-worker-ab.js\";\n    this.audioWorkletUrl =\n      config.audioWorkletUrl || \"workers/audio-worklet1.js\";\n    this.mstgPolyfillUrl =\n      config.mstgPolyfillUrl || \"polyfills/MSTG_polyfill.js\";\n\n    // State\n    this.isStarted = false;\n    this.isAudioEnabled = true;\n    this.connectionStatus = \"disconnected\"; // 'disconnected', 'connecting', 'connected', 'failed'\n\n    // Media components\n    this.worker = null;\n    this.audioWorkletNode = null;\n    this.videoGenerator = null;\n    this.videoWriter = null;\n    this.mediaStream = null;\n\n    // Unique subscriber ID\n    this.subscriberId = `subscriber_${this.streamId}_${Date.now()}`;\n\n    // Audio mixer reference (will be set externally)\n    this.audioMixer = null;\n  }\n\n  /**\n   * Start the subscriber\n   */\n  async start() {\n    if (this.isStarted) {\n      throw new Error(\"Subscriber already started\");\n    }\n\n    try {\n      console.log(\"Starting subscriber:\", this.subscriberId);\n      this.emit(\"starting\", { subscriber: this });\n      this._updateConnectionStatus(\"connecting\");\n\n      const channel = new MessageChannel();\n\n      await this._loadPolyfill();\n      await this._initWorker(channel.port2);\n      await this._initAudioSystem(channel.port1);\n      this._initVideoSystem();\n\n      this.isStarted = true;\n      this._updateConnectionStatus(\"connected\");\n      this.emit(\"started\", { subscriber: this });\n    } catch (error) {\n      this._updateConnectionStatus(\"failed\");\n      this.emit(\"error\", { subscriber: this, error, action: \"start\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Stop the subscriber\n   */\n  stop() {\n    if (!this.isStarted) {\n      return;\n    }\n\n    try {\n      this.emit(\"stopping\", { subscriber: this });\n\n      // Remove from audio mixer\n      if (this.audioMixer) {\n        this.audioMixer.removeSubscriber(this.subscriberId);\n      }\n\n      // Terminate worker\n      if (this.worker) {\n        this.worker.terminate();\n        this.worker = null;\n      }\n\n      // Emit stream removal event for app integration\n      if (this.mediaStream) {\n        this.emit(\"streamRemoved\", {\n          streamId: this.streamId,\n          subscriberId: this.subscriberId,\n          roomId: this.roomId\n        });\n      }\n\n      // Close video components\n      this._cleanupVideoSystem();\n\n      // Clear references\n      this.audioWorkletNode = null;\n      this.mediaStream = null;\n\n      this.isStarted = false;\n      this._updateConnectionStatus(\"disconnected\");\n      this.emit(\"stopped\", { subscriber: this });\n    } catch (error) {\n      this.emit(\"error\", { subscriber: this, error, action: \"stop\" });\n    }\n  }\n\n  /**\n   * Toggle audio on/off\n   */\n  async toggleAudio() {\n    if (!this.isStarted || !this.worker) {\n      throw new Error(\"Subscriber not started\");\n    }\n\n    try {\n      this.worker.postMessage({ type: \"toggleAudio\" });\n      this.isAudioEnabled = !this.isAudioEnabled;\n\n      this.emit(\"audioToggled\", {\n        subscriber: this,\n        enabled: this.isAudioEnabled,\n      });\n\n      return this.isAudioEnabled;\n    } catch (error) {\n      this.emit(\"error\", { subscriber: this, error, action: \"toggleAudio\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Set audio mixer reference\n   */\n  setAudioMixer(audioMixer) {\n    this.audioMixer = audioMixer;\n  }\n\n  /**\n   * Get subscriber info\n   */\n  getInfo() {\n    return {\n      subscriberId: this.subscriberId,\n      streamId: this.streamId,\n      roomId: this.roomId,\n      host: this.host,\n      isOwnStream: this.isOwnStream,\n      isStarted: this.isStarted,\n      isAudioEnabled: this.isAudioEnabled,\n      connectionStatus: this.connectionStatus,\n    };\n  }\n\n  /**\n   * Load MediaStreamTrackGenerator polyfill if needed\n   */\n  async _loadPolyfill() {\n    if (!window.MediaStreamTrackGenerator) {\n      try {\n        await import(this.mstgPolyfillUrl);\n      } catch (error) {\n        console.warn(\"Failed to load MSTG polyfill:\", error);\n      }\n    }\n  }\n\n  /**\n   * Initialize media worker\n   */\n  async _initWorker(channelPort) {\n    try {\n      this.worker = new Worker(`${this.mediaWorkerUrl}?t=${Date.now()}`, {\n        type: \"module\",\n      });\n\n      this.worker.onmessage = (e) => this._handleWorkerMessage(e);\n      this.worker.onerror = (error) => {\n        this.emit(\"error\", {\n          subscriber: this,\n          error: new Error(`Media Worker error: ${error.message}`),\n          action: \"workerError\",\n        });\n      };\n\n      const mediaUrl = `wss://sfu-adaptive-bitrate.ermis-network.workers.dev/meeting/${this.roomId}/${this.streamId}`;\n      console.log(\"try to init worker with url:\", mediaUrl);\n\n      this.worker.postMessage(\n        {\n          type: \"init\",\n          data: { mediaUrl },\n          port: channelPort,\n          quality: \"360p\", // default quality\n        },\n        [channelPort]\n      );\n    } catch (error) {\n      throw new Error(`Worker initialization failed: ${error.message}`);\n    }\n  }\n\n  switchBitrate(quality) {\n    // 360p | 720p\n    if (this.worker) {\n      this.worker.postMessage({\n        type: \"switchBitrate\",\n        quality,\n      });\n    }\n  }\n\n  /**\n   * Initialize audio system with mixer\n   */\n  async _initAudioSystem(channelPort) {\n    try {\n      // Skip audio setup for own stream to prevent echo\n      if (this.isOwnStream) {\n        this.emit(\"audioSkipped\", {\n          subscriber: this,\n          reason: \"Own stream - preventing echo\",\n        });\n        return;\n      }\n\n      // Audio mixer should be set externally before starting\n      if (this.audioMixer) {\n        console.warn(\n          \"Adding subscriber to audio mixer in new subscriber:\",\n          this.subscriberId\n        );\n        this.audioWorkletNode = await this.audioMixer.addSubscriber(\n          this.subscriberId,\n          this.audioWorkletUrl,\n          this.isOwnStream,\n          channelPort\n        );\n\n        if (this.audioWorkletNode) {\n          this.audioWorkletNode.port.onmessage = (event) => {\n            const { type, bufferMs, isPlaying, newBufferSize } = event.data;\n            this.emit(\"audioStatus\", {\n              subscriber: this,\n              type,\n              bufferMs,\n              isPlaying,\n              newBufferSize,\n            });\n          };\n        }\n      }\n\n      this.emit(\"audioInitialized\", { subscriber: this });\n    } catch (error) {\n      throw new Error(`Audio system initialization failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * Initialize video system\n   */\n  _initVideoSystem() {\n    try {\n      if (typeof MediaStreamTrackGenerator === \"function\") {\n        this.videoGenerator = new MediaStreamTrackGenerator({\n          kind: \"video\",\n        });\n      } else {\n        throw new Error(\n          \"MediaStreamTrackGenerator not supported in this browser\"\n        );\n      }\n\n      this.videoWriter = this.videoGenerator.writable;\n\n      // Create MediaStream with video track only\n      this.mediaStream = new MediaStream([this.videoGenerator]);\n\n      // Emit remote stream ready event for app integration\n      this.emit(\"remoteStreamReady\", {\n        stream: this.mediaStream,\n        streamId: this.streamId,\n        subscriberId: this.subscriberId,\n        roomId: this.roomId,\n        isOwnStream: this.isOwnStream\n      });\n      this.emit(\"videoInitialized\", { subscriber: this });\n    } catch (error) {\n      throw new Error(`Video system initialization failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * Cleanup video system\n   */\n  _cleanupVideoSystem() {\n    try {\n      // Close video writer\n      if (this.videoWriter) {\n        try {\n          const writer = this.videoWriter.getWriter();\n          writer.releaseLock();\n        } catch (e) {\n          // Writer might already be released\n        }\n        this.videoWriter = null;\n      }\n\n      // Stop video generator\n      if (this.videoGenerator) {\n        try {\n          if (this.videoGenerator.stop) {\n            this.videoGenerator.stop();\n          }\n        } catch (e) {\n          // Generator might already be stopped\n        }\n        this.videoGenerator = null;\n      }\n    } catch (error) {\n      console.warn(\"Error cleaning video system:\", error);\n    }\n  }\n\n  /**\n   * Handle messages from media worker\n   */\n  _handleWorkerMessage(e) {\n    const {\n      type,\n      frame,\n      message,\n      channelData,\n      sampleRate,\n      numberOfChannels,\n      timeStamp,\n      subscriberId,\n      audioEnabled,\n    } = e.data;\n\n    switch (type) {\n      case \"videoData\":\n        this._handleVideoData(frame);\n        break;\n\n      case \"status\":\n        this.emit(\"status\", { subscriber: this, message, isError: false });\n        break;\n\n      case \"error\":\n        this.emit(\"status\", { subscriber: this, message, isError: true });\n        this.emit(\"error\", {\n          subscriber: this,\n          error: new Error(message),\n          action: \"workerMessage\",\n        });\n        break;\n\n      case \"audio-toggled\":\n        this.emit(\"audioToggled\", {\n          subscriber: this,\n          enabled: audioEnabled,\n        });\n        break;\n\n      case \"skipping\":\n        this.emit(\"frameSkipped\", { subscriber: this });\n        break;\n\n      case \"resuming\":\n        this.emit(\"frameResumed\", { subscriber: this });\n        break;\n\n      default:\n        console.log(`Unknown worker message type: ${type}`, e.data);\n    }\n  }\n\n  /**\n   * Handle video data from worker\n   */\n  async _handleVideoData(frame) {\n    if (this.videoWriter && frame) {\n      try {\n        const writer = this.videoWriter.getWriter();\n        await writer.write(frame);\n        writer.releaseLock();\n\n        this.emit(\"videoFrameProcessed\", { subscriber: this });\n      } catch (error) {\n        this.emit(\"error\", {\n          subscriber: this,\n          error: new Error(`Video write error: ${error.message}`),\n          action: \"videoWrite\",\n        });\n      }\n    }\n  }\n\n  /**\n   * Update connection status\n   */\n  _updateConnectionStatus(status) {\n    if (this.connectionStatus === status) return;\n\n    const previousStatus = this.connectionStatus;\n    this.connectionStatus = status;\n\n    this.emit(\"connectionStatusChanged\", {\n      subscriber: this,\n      status,\n      previousStatus,\n    });\n  }\n}\n\nexport default Subscriber;\n","/**\n * AudioMixer Class for combining multiple subscriber audio streams\n * Provides centralized audio mixing and playback management\n */\nclass AudioMixer {\n  constructor(config = {}) {\n    this.audioContext = null;\n    this.mixerNode = null;\n    this.outputDestination = null;\n    this.subscriberNodes = new Map(); // subscriberId -> AudioWorkletNode\n    this.isInitialized = false;\n    this.outputAudioElement = null;\n\n    // Configuration\n    this.masterVolume = config.masterVolume || 0.8;\n    this.sampleRate = config.sampleRate || 48000;\n    this.bufferSize = config.bufferSize || 256;\n    this.enableEchoCancellation = config.enableEchoCancellation !== false;\n    this.debug = config.debug || false;\n  }\n\n  /**\n   * Initialize the audio mixer\n   */\n  async initialize() {\n    if (this.isInitialized) {\n      this._debug(\"AudioMixer already initialized\");\n      return;\n    }\n\n    try {\n      // Create shared AudioContext\n      this.audioContext = new (window.AudioContext ||\n        window.webkitAudioContext)({\n        sampleRate: this.sampleRate,\n        latencyHint: \"interactive\",\n      });\n\n      // Resume context if suspended (required by some browsers)\n      if (this.audioContext.state === \"suspended\") {\n        await this.audioContext.resume();\n      }\n\n      // Create mixer node (GainNode to combine audio)\n      this.mixerNode = this.audioContext.createGain();\n      this.mixerNode.gain.value = this.masterVolume;\n\n      // Create output destination\n      this.outputDestination = this.audioContext.createMediaStreamDestination();\n      this.mixerNode.connect(this.outputDestination);\n\n      // Create hidden audio element for mixed audio playback\n      this.outputAudioElement = document.createElement(\"audio\");\n      this.outputAudioElement.autoplay = true;\n      this.outputAudioElement.style.display = \"none\";\n      this.outputAudioElement.setAttribute(\"playsinline\", \"\");\n\n      // Disable echo cancellation on output element\n      if (this.enableEchoCancellation) {\n        this.outputAudioElement.setAttribute(\"webkitAudioContext\", \"true\");\n      }\n\n      document.body.appendChild(this.outputAudioElement);\n\n      this.isInitialized = true;\n      this._debug(\"AudioMixer initialized successfully\");\n\n      // Setup error handlers\n      this._setupErrorHandlers();\n    } catch (error) {\n      console.error(\"Failed to initialize AudioMixer:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Add a subscriber's audio stream to the mixer\n   */\n  async addSubscriber(\n    subscriberId,\n    audioWorkletUrl,\n    isOwnAudio = false,\n    channelWorkletPort\n  ) {\n    console.warn(`Adding subscriber ${subscriberId} to audio mixer`);\n    if (!this.isInitialized) {\n      await this.initialize();\n    }\n\n    // Skip adding own audio to prevent echo/feedback\n    if (isOwnAudio) {\n      this._debug(\n        `Skipping own audio for subscriber ${subscriberId} to prevent echo`\n      );\n      return null;\n    }\n\n    // Check if subscriber already exists\n    if (this.subscriberNodes.has(subscriberId)) {\n      this._debug(`Subscriber ${subscriberId} already exists in mixer`);\n      return this.subscriberNodes.get(subscriberId);\n    }\n\n    try {\n      // Load audio worklet if not already loaded\n      await this._loadAudioWorklet(audioWorkletUrl);\n\n      // Create AudioWorkletNode for this subscriber\n      const workletNode = new AudioWorkletNode(\n        this.audioContext,\n        \"jitter-resistant-processor\",\n        {\n          numberOfInputs: 0,\n          numberOfOutputs: 1,\n          outputChannelCount: [2],\n        }\n      );\n\n      // Connect the port if provided\n      if (channelWorkletPort) {\n        workletNode.port.postMessage(\n          { type: \"connectWorker\", port: channelWorkletPort },\n          [channelWorkletPort]\n        );\n      }\n\n      // Create gain node for individual volume control\n      const gainNode = this.audioContext.createGain();\n      gainNode.gain.value = 1.0;\n\n      // Connect: workletNode -> gainNode -> mixerNode\n      workletNode.connect(gainNode);\n      gainNode.connect(this.mixerNode);\n\n      // Store reference with gain node\n      this.subscriberNodes.set(subscriberId, {\n        workletNode,\n        gainNode,\n        isActive: true,\n        addedAt: Date.now(),\n      });\n\n      // Update audio element source with mixed stream\n      this._updateOutputAudio();\n\n      // Setup message handler\n      this._setupWorkletMessageHandler(subscriberId, workletNode);\n\n      this._debug(`Added subscriber ${subscriberId} to audio mixer`);\n      return workletNode;\n    } catch (error) {\n      console.error(\n        `Failed to add subscriber ${subscriberId} to mixer:`,\n        error\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Remove a subscriber from the mixer\n   */\n  removeSubscriber(subscriberId) {\n    const subscriberData = this.subscriberNodes.get(subscriberId);\n    if (!subscriberData) {\n      this._debug(`Subscriber ${subscriberId} not found in mixer`);\n      return false;\n    }\n\n    try {\n      const { workletNode, gainNode } = subscriberData;\n\n      // Disconnect nodes\n      workletNode.disconnect();\n      gainNode.disconnect();\n\n      // Remove from map\n      this.subscriberNodes.delete(subscriberId);\n\n      // Update audio element if no more subscribers\n      this._updateOutputAudio();\n\n      this._debug(`Removed subscriber ${subscriberId} from audio mixer`);\n      return true;\n    } catch (error) {\n      console.error(`Failed to remove subscriber ${subscriberId}:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Set volume for a specific subscriber\n   */\n  setSubscriberVolume(subscriberId, volume) {\n    const subscriberData = this.subscriberNodes.get(subscriberId);\n    if (!subscriberData) {\n      this._debug(`Subscriber ${subscriberId} not found for volume adjustment`);\n      return false;\n    }\n\n    try {\n      const normalizedVolume = Math.max(0, Math.min(1, volume));\n      subscriberData.gainNode.gain.value = normalizedVolume;\n\n      this._debug(\n        `Set volume for subscriber ${subscriberId}: ${normalizedVolume}`\n      );\n      return true;\n    } catch (error) {\n      console.error(\n        `Failed to set volume for subscriber ${subscriberId}:`,\n        error\n      );\n      return false;\n    }\n  }\n\n  /**\n   * Mute/unmute a specific subscriber\n   */\n  setSubscriberMuted(subscriberId, muted) {\n    return this.setSubscriberVolume(subscriberId, muted ? 0 : 1);\n  }\n\n  /**\n   * Set master volume for all mixed audio\n   */\n  setMasterVolume(volume) {\n    if (!this.mixerNode) return false;\n\n    try {\n      const normalizedVolume = Math.max(0, Math.min(1, volume));\n      this.mixerNode.gain.value = normalizedVolume;\n      this.masterVolume = normalizedVolume;\n\n      this._debug(`Set master volume: ${normalizedVolume}`);\n      return true;\n    } catch (error) {\n      console.error(\"Failed to set master volume:\", error);\n      return false;\n    }\n  }\n\n  /**\n   * Get mixed audio output stream\n   */\n  getOutputMediaStream() {\n    if (!this.outputDestination) {\n      this._debug(\"Output destination not initialized\");\n      return null;\n    }\n    return this.outputDestination.stream;\n  }\n\n  /**\n   * Get current mixer statistics\n   */\n  getStats() {\n    return {\n      isInitialized: this.isInitialized,\n      subscriberCount: this.subscriberNodes.size,\n      masterVolume: this.masterVolume,\n      audioContextState: this.audioContext?.state || \"not-initialized\",\n      sampleRate: this.audioContext?.sampleRate || 0,\n      subscribers: Array.from(this.subscriberNodes.entries()).map(\n        ([id, data]) => ({\n          id,\n          volume: data.gainNode.gain.value,\n          isActive: data.isActive,\n          addedAt: data.addedAt,\n        })\n      ),\n    };\n  }\n\n  /**\n   * Get list of subscriber IDs\n   */\n  getSubscriberIds() {\n    return Array.from(this.subscriberNodes.keys());\n  }\n\n  /**\n   * Check if subscriber exists in mixer\n   */\n  hasSubscriber(subscriberId) {\n    return this.subscriberNodes.has(subscriberId);\n  }\n\n  /**\n   * Suspend audio context (for battery saving)\n   */\n  async suspend() {\n    if (this.audioContext && this.audioContext.state === \"running\") {\n      await this.audioContext.suspend();\n      this._debug(\"Audio context suspended\");\n    }\n  }\n\n  /**\n   * Resume audio context\n   */\n  async resume() {\n    if (this.audioContext && this.audioContext.state === \"suspended\") {\n      await this.audioContext.resume();\n      this._debug(\"Audio context resumed\");\n    }\n  }\n\n  /**\n   * Cleanup mixer resources\n   */\n  async cleanup() {\n    this._debug(\"Starting AudioMixer cleanup\");\n\n    try {\n      // Remove audio element\n      if (this.outputAudioElement) {\n        this.outputAudioElement.srcObject = null;\n        if (this.outputAudioElement.parentNode) {\n          this.outputAudioElement.parentNode.removeChild(\n            this.outputAudioElement\n          );\n        }\n        this.outputAudioElement = null;\n      }\n\n      // Disconnect all subscribers\n      for (const [subscriberId, subscriberData] of this.subscriberNodes) {\n        try {\n          const { workletNode, gainNode } = subscriberData;\n          workletNode.disconnect();\n          gainNode.disconnect();\n        } catch (error) {\n          console.error(\n            `Error disconnecting subscriber ${subscriberId}:`,\n            error\n          );\n        }\n      }\n      this.subscriberNodes.clear();\n\n      // Disconnect mixer components\n      if (this.mixerNode) {\n        this.mixerNode.disconnect();\n        this.mixerNode = null;\n      }\n\n      if (this.outputDestination) {\n        this.outputDestination = null;\n      }\n\n      // Close audio context\n      if (this.audioContext && this.audioContext.state !== \"closed\") {\n        await this.audioContext.close();\n      }\n\n      // Reset state\n      this.audioContext = null;\n      this.isInitialized = false;\n\n      this._debug(\"AudioMixer cleanup completed\");\n    } catch (error) {\n      console.error(\"Error during AudioMixer cleanup:\", error);\n    }\n  }\n\n  /**\n   * Load audio worklet module\n   */\n  async _loadAudioWorklet(audioWorkletUrl) {\n    console.warn(\"Loading audio worklet from:\", audioWorkletUrl);\n    try {\n      await this.audioContext.audioWorklet.addModule(audioWorkletUrl);\n      this._debug(\"Audio worklet loaded:\", audioWorkletUrl);\n    } catch (error) {\n      // Worklet might already be loaded\n      if (!error.message.includes(\"already been loaded\")) {\n        this._debug(\"Audio worklet load warning:\", error.message);\n      }\n    }\n  }\n\n  /**\n   * Update output audio element\n   */\n  _updateOutputAudio() {\n    if (!this.outputAudioElement || !this.outputDestination) return;\n\n    try {\n      if (this.subscriberNodes.size > 0) {\n        this.outputAudioElement.srcObject = this.outputDestination.stream;\n      } else {\n        this.outputAudioElement.srcObject = null;\n      }\n    } catch (error) {\n      console.error(\"Failed to update output audio:\", error);\n    }\n  }\n\n  /**\n   * Setup message handler for worklet node\n   */\n  _setupWorkletMessageHandler(subscriberId, workletNode) {\n    workletNode.port.onmessage = (event) => {\n      const { type, bufferMs, isPlaying, newBufferSize, error } = event.data;\n\n      switch (type) {\n        case \"bufferStatus\":\n          this._debug(\n            `Subscriber ${subscriberId} buffer: ${bufferMs}ms, playing: ${isPlaying}`\n          );\n          break;\n        case \"bufferSizeChanged\":\n          this._debug(\n            `Subscriber ${subscriberId} buffer size changed: ${newBufferSize}`\n          );\n          break;\n        case \"error\":\n          console.error(`Subscriber ${subscriberId} worklet error:`, error);\n          break;\n        default:\n          this._debug(\n            `Subscriber ${subscriberId} worklet message:`,\n            event.data\n          );\n      }\n    };\n\n    workletNode.port.onerror = (error) => {\n      console.error(`Subscriber ${subscriberId} worklet port error:`, error);\n    };\n  }\n\n  /**\n   * Setup error handlers for audio context\n   */\n  _setupErrorHandlers() {\n    if (!this.audioContext) return;\n\n    this.audioContext.onstatechange = () => {\n      this._debug(`Audio context state changed: ${this.audioContext.state}`);\n\n      if (this.audioContext.state === \"interrupted\") {\n        console.warn(\"Audio context was interrupted\");\n      }\n    };\n\n    // Listen for audio context suspend/resume events\n    document.addEventListener(\"visibilitychange\", async () => {\n      if (document.hidden) {\n        // Page hidden - optionally suspend context\n        // await this.suspend();\n      } else {\n        // Page visible - resume context if needed\n        await this.resume();\n      }\n    });\n  }\n\n  /**\n   * Debug logging\n   */\n  _debug(...args) {\n    if (this.debug) {\n      console.log(\"[AudioMixer]\", ...args);\n    }\n  }\n\n  /**\n   * Sleep utility for delays\n   */\n  _sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n}\n\nexport default AudioMixer;\n","import EventEmitter from \"../events/EventEmitter.js\";\nimport Participant from \"./Participant.js\";\n\nimport Publisher from \"../media/Publisher.js\";\nimport Subscriber from \"../media/Subscriber.js\";\nimport AudioMixer from \"../media/AudioMixer.js\";\n\n/**\n * Represents a meeting room\n */\nclass Room extends EventEmitter {\n  constructor(config) {\n    super();\n\n    this.id = config.id;\n    this.name = config.name;\n    this.code = config.code;\n    this.type = config.type || \"main\"; // 'main', 'breakout'\n    this.parentRoomId = config.parentRoomId || null;\n    this.ownerId = config.ownerId;\n    this.isActive = false;\n\n    // Configuration\n    this.apiClient = config.apiClient;\n    this.mediaConfig = config.mediaConfig;\n\n    // Participants management\n    this.participants = new Map(); // userId -> Participant\n    this.localParticipant = null;\n\n    // Sub rooms (for main rooms only)\n    this.subRooms = new Map(); // subRoomId -> Room\n\n    // Media management\n    this.audioMixer = null;\n    this.pinnedParticipant = null;\n\n    // Connection info\n    this.membershipId = null;\n    this.streamId = null;\n\n    // Chat management\n    this.messages = [];\n    this.typingUsers = new Map();\n  }\n\n  /**\n   * Join this room\n   */\n  async join(userId) {\n    if (this.isActive) {\n      throw new Error(\"Already joined this room\");\n    }\n\n    try {\n      this.emit(\"joining\", { room: this });\n      console.log(\"Joining room with code\", this.code);\n      // Join via API\n      const joinResponse = await this.apiClient.joinRoom(this.code);\n\n      // Store connection info\n      this.id = joinResponse.room_id;\n      this.membershipId = joinResponse.id;\n      this.streamId = joinResponse.stream_id;\n\n      // Get room details and members\n      const roomDetails = await this.apiClient.getRoomById(\n        joinResponse.room_id\n      );\n      console.log(\"Joined room, details:\", roomDetails);\n\n      // Update room info\n      this._updateFromApiData(roomDetails.room);\n\n      // Setup participants\n      await this._setupParticipants(roomDetails.participants, userId);\n\n      // Setup media connections\n      await this._setupMediaConnections();\n\n      this.isActive = true;\n      this.emit(\"joined\", { room: this, participants: this.participants });\n\n      return {\n        room: this,\n        localParticipant: this.localParticipant,\n        participants: Array.from(this.participants.values()),\n      };\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"join\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Leave this room\n   */\n  async leave() {\n    if (!this.isActive) {\n      return;\n    }\n\n    try {\n      this.emit(\"leaving\", { room: this });\n\n      // Cleanup media connections\n      await this._cleanupMediaConnections();\n\n      // Cleanup participants\n      this._cleanupParticipants();\n\n      // Leave via API\n      if (this.membershipId) {\n        await this.apiClient.leaveRoom(this.id, this.membershipId);\n      }\n\n      this.isActive = false;\n      this.emit(\"left\", { room: this });\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"leave\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Create a sub room (main room only)\n   */\n  async createSubRoom(config) {\n    if (this.type !== \"main\") {\n      throw new Error(\"Only main rooms can create sub rooms\");\n    }\n\n    try {\n      this.emit(\"creatingSubRoom\", { room: this, config });\n\n      // Create sub room via API\n      const subRoomData = await this.apiClient.createSubRoom(\n        this.id,\n        config.name,\n        config.type || \"breakout\"\n      );\n\n      // Create sub room instance\n      const subRoom = new Room({\n        id: subRoomData.id,\n        name: subRoomData.room_name,\n        code: subRoomData.room_code,\n        type: config.type || \"breakout\",\n        parentRoomId: this.id,\n        ownerId: subRoomData.user_id,\n        apiClient: this.apiClient,\n        mediaConfig: this.mediaConfig,\n      });\n\n      // Store sub room\n      this.subRooms.set(subRoom.id, subRoom);\n\n      this.emit(\"subRoomCreated\", { room: this, subRoom });\n\n      return subRoom;\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"createSubRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Get all sub rooms\n   */\n  async getSubRooms() {\n    if (this.type !== \"main\") {\n      return [];\n    }\n\n    try {\n      const subRoomsData = await this.apiClient.getSubRooms(this.id);\n\n      // Update local sub rooms map\n      for (const subRoomData of subRoomsData) {\n        if (!this.subRooms.has(subRoomData.id)) {\n          const subRoom = new Room({\n            id: subRoomData.id,\n            name: subRoomData.room_name,\n            code: subRoomData.room_code,\n            type: subRoomData.room_type,\n            parentRoomId: this.id,\n            ownerId: subRoomData.user_id,\n            apiClient: this.apiClient,\n            mediaConfig: this.mediaConfig,\n          });\n\n          this.subRooms.set(subRoom.id, subRoom);\n        }\n      }\n\n      return Array.from(this.subRooms.values());\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"getSubRooms\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Switch to a sub room\n   */\n  async switchToSubRoom(subRoomCode) {\n    try {\n      this.emit(\"switchingToSubRoom\", { room: this, subRoomCode });\n\n      // Switch via API\n      const switchResponse = await this.apiClient.switchToSubRoom(\n        this.id,\n        subRoomCode\n      );\n\n      // Cleanup current media connections but keep participants\n      await this._cleanupMediaConnections();\n\n      // Update connection info for new sub room\n      this.membershipId = switchResponse.id;\n      this.streamId = switchResponse.stream_id;\n\n      // Setup media connections for sub room\n      await this._setupMediaConnections();\n\n      this.emit(\"switchedToSubRoom\", {\n        room: this,\n        subRoomCode,\n        response: switchResponse,\n      });\n\n      return switchResponse;\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"switchToSubRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Return to main room from sub room\n   */\n  async returnToMainRoom() {\n    if (!this.parentRoomId) {\n      throw new Error(\"This is not a sub room\");\n    }\n\n    try {\n      this.emit(\"returningToMainRoom\", { room: this });\n\n      // Leave current sub room\n      await this.leave();\n\n      // The parent should handle rejoining main room\n      this.emit(\"returnedToMainRoom\", { room: this });\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"returnToMainRoom\" });\n      throw error;\n    }\n  }\n\n  async sendMessage(text, metadata = {}) {\n    if (!this.isActive) {\n      throw new Error(\"Cannot send message: room is not active\");\n    }\n\n    if (!this.localParticipant?.publisher) {\n      throw new Error(\"Cannot send message: publisher not available\");\n    }\n\n    if (!text || typeof text !== \"string\" || text.trim().length === 0) {\n      throw new Error(\"Message text is required and must be a non-empty string\");\n    }\n\n    try {\n      const messageId = this._generateMessageId();\n      const message = {\n        id: messageId,\n        text: text.trim(),\n        senderId: this.localParticipant.userId,\n        senderName: metadata.senderName || this.localParticipant.userId,\n        roomId: this.id,\n        timestamp: Date.now(),\n        metadata: metadata.customData || {},\n      };\n\n      const messageEvent = {\n        type: \"message\",\n        ...message,\n      };\n\n      await this.localParticipant.publisher.sendEvent(messageEvent);\n\n      this.messages.push(message);\n\n      this.emit(\"messageSent\", {\n        room: this,\n        message,\n      });\n\n      return message;\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"sendMessage\" });\n      throw error;\n    }\n  }\n\n  async deleteMessage(messageId) {\n    if (!this.isActive) {\n      throw new Error(\"Cannot delete message: room is not active\");\n    }\n\n    if (!this.localParticipant?.publisher) {\n      throw new Error(\"Cannot delete message: publisher not available\");\n    }\n\n    try {\n      const deleteEvent = {\n        type: \"messageDelete\",\n        messageId,\n        senderId: this.localParticipant.userId,\n        roomId: this.id,\n        timestamp: Date.now(),\n      };\n\n      await this.localParticipant.publisher.sendEvent(deleteEvent);\n\n      this.messages = this.messages.filter((m) => m.id !== messageId);\n\n      this.emit(\"messageDeleted\", {\n        room: this,\n        messageId,\n      });\n\n      return true;\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"deleteMessage\" });\n      throw error;\n    }\n  }\n\n  async updateMessage(messageId, newText, metadata = {}) {\n    if (!this.isActive) {\n      throw new Error(\"Cannot update message: room is not active\");\n    }\n\n    if (!this.localParticipant?.publisher) {\n      throw new Error(\"Cannot update message: publisher not available\");\n    }\n\n    if (!newText || typeof newText !== \"string\" || newText.trim().length === 0) {\n      throw new Error(\"New message text is required and must be a non-empty string\");\n    }\n\n    try {\n      const updateEvent = {\n        type: \"messageUpdate\",\n        messageId,\n        text: newText.trim(),\n        senderId: this.localParticipant.userId,\n        roomId: this.id,\n        timestamp: Date.now(),\n        metadata: metadata.customData || {},\n      };\n\n      await this.localParticipant.publisher.sendEvent(updateEvent);\n\n      const messageIndex = this.messages.findIndex((m) => m.id === messageId);\n      if (messageIndex !== -1) {\n        this.messages[messageIndex].text = newText.trim();\n        this.messages[messageIndex].updatedAt = Date.now();\n        this.messages[messageIndex].metadata = {\n          ...this.messages[messageIndex].metadata,\n          ...updateEvent.metadata,\n        };\n      }\n\n      this.emit(\"messageUpdated\", {\n        room: this,\n        messageId,\n        text: newText.trim(),\n      });\n\n      return true;\n    } catch (error) {\n      this.emit(\"error\", { room: this, error, action: \"updateMessage\" });\n      throw error;\n    }\n  }\n\n  async sendTypingIndicator(isTyping = true) {\n    if (!this.isActive) {\n      return;\n    }\n\n    if (!this.localParticipant?.publisher) {\n      return;\n    }\n\n    try {\n      const typingEvent = {\n        type: isTyping ? \"typingStart\" : \"typingStop\",\n        userId: this.localParticipant.userId,\n        roomId: this.id,\n        timestamp: Date.now(),\n      };\n\n      await this.localParticipant.publisher.sendEvent(typingEvent);\n    } catch (error) {\n      console.error(\"Failed to send typing indicator:\", error);\n    }\n  }\n\n  getMessages(limit = 100) {\n    return this.messages.slice(-limit);\n  }\n\n  getTypingUsers() {\n    return Array.from(this.typingUsers.values());\n  }\n\n  clearMessages() {\n    this.messages = [];\n  }\n\n  /**\n   * Add a participant to the room\n   */\n  addParticipant(memberData, userId) {\n    const isLocal = memberData.user_id === userId;\n\n    const participant = new Participant({\n      userId: memberData.user_id,\n      streamId: memberData.stream_id,\n      membershipId: memberData.id,\n      role: memberData.role,\n      roomId: this.id,\n      isLocal,\n    });\n\n    // Setup participant events\n    this._setupParticipantEvents(participant);\n\n    this.participants.set(participant.userId, participant);\n\n    if (isLocal) {\n      this.localParticipant = participant;\n    }\n\n    this.emit(\"participantAdded\", { room: this, participant });\n\n    return participant;\n  }\n\n  /**\n   * Remove a participant from the room\n   */\n  removeParticipant(userId) {\n    const participant = this.participants.get(userId);\n    if (!participant) return null;\n\n    // Cleanup participant\n    participant.cleanup();\n\n    // Remove from maps\n    this.participants.delete(userId);\n\n    if (this.localParticipant?.userId === userId) {\n      this.localParticipant = null;\n    }\n\n    if (this.pinnedParticipant?.userId === userId) {\n      this.pinnedParticipant = null;\n    }\n\n    this.emit(\"participantRemoved\", { room: this, participant });\n\n    return participant;\n  }\n\n  /**\n   * Get a participant by user ID\n   */\n  getParticipant(userId) {\n    return this.participants.get(userId);\n  }\n\n  /**\n   * Get all participants\n   */\n  getParticipants() {\n    return Array.from(this.participants.values());\n  }\n\n  /**\n   * Pin a participant's video\n   */\n  // pinParticipant(userId) {\n  //   const participant = this.participants.get(userId);\n  //   if (!participant) return false;\n\n  //   // Unpin current participant\n  //   if (this.pinnedParticipant) {\n  //     this.pinnedParticipant.isPinned = false;\n  //   }\n\n  //   // Pin new participant\n  //   participant.isPinned = true;\n  //   this.pinnedParticipant = participant;\n\n  //   this.emit(\"participantPinned\", { room: this, participant });\n\n  //   return true;\n  // }\n\n  pinParticipant(userId) {\n    const participant = this.participants.get(userId);\n    if (!participant) return false;\n\n    // Unpin current participant và move về sidebar\n    if (this.pinnedParticipant && this.pinnedParticipant !== participant) {\n      this.pinnedParticipant.isPinned = false;\n    }\n\n    // Pin new participant và move lên main\n    participant.isPinned = true;\n    this.pinnedParticipant = participant;\n\n    this.emit(\"participantPinned\", { room: this, participant });\n\n    return true;\n  }\n\n  /**\n   * Unpin currently pinned participant\n   */\n  // unpinParticipant() {\n  //   if (!this.pinnedParticipant) return false;\n\n  //   this.pinnedParticipant.isPinned = false;\n  //   const unpinnedParticipant = this.pinnedParticipant;\n  //   this.pinnedParticipant = null;\n\n  //   this.emit(\"participantUnpinned\", {\n  //     room: this,\n  //     participant: unpinnedParticipant,\n  //   });\n\n  //   return true;\n  // }\n\n  unpinParticipant() {\n    if (!this.pinnedParticipant) return false;\n\n    this.pinnedParticipant.isPinned = false;\n    const unpinnedParticipant = this.pinnedParticipant;\n\n    this.pinnedParticipant = null;\n\n    // Auto-pin local participant nếu có\n    if (this.localParticipant) {\n      this.pinParticipant(this.localParticipant.userId);\n    }\n\n    this.emit(\"participantUnpinned\", {\n      room: this,\n      participant: unpinnedParticipant,\n    });\n\n    return true;\n  }\n\n  /**\n   * Get room info\n   */\n  getInfo() {\n    return {\n      id: this.id,\n      name: this.name,\n      code: this.code,\n      type: this.type,\n      parentRoomId: this.parentRoomId,\n      ownerId: this.ownerId,\n      isActive: this.isActive,\n      participantCount: this.participants.size,\n      subRoomCount: this.subRooms.size,\n      pinnedParticipant: this.pinnedParticipant?.userId || null,\n    };\n  }\n\n  /**\n   * Setup participants from API data\n   */\n  async _setupParticipants(participantsData, userId) {\n    for (const participantData of participantsData) {\n      this.addParticipant(participantData, userId);\n    }\n  }\n\n  /**\n   * Setup media connections for all participants\n   */\n  async _setupMediaConnections() {\n    // Initialize audio mixer\n    if (!this.audioMixer) {\n      this.audioMixer = new AudioMixer();\n      await this.audioMixer.initialize();\n    }\n\n    // Setup publisher for local participant\n    if (this.localParticipant) {\n      await this._setupLocalPublisher();\n    }\n\n    // Setup subscribers for remote participants\n    for (const participant of this.participants.values()) {\n      if (!participant.isLocal) {\n        await this._setupRemoteSubscriber(participant);\n      }\n    }\n\n    // Setup stream event forwarding\n    this._setupStreamEventForwarding();\n  }\n\n  /**\n   * Setup publisher for local participant\n   */\n  async _setupLocalPublisher() {\n    if (!this.localParticipant || !this.streamId) return;\n\n    // Video rendering handled by app through stream events\n\n    const publishUrl = `${this.mediaConfig.webtpUrl}/${this.id}/${this.streamId}`;\n    console.log(\"trying to connect webtransport to\", publishUrl);\n\n    const publisher = new Publisher({\n      publishUrl,\n      streamType: \"camera\",\n      streamId: this.streamId,\n      width: 1280,\n      height: 720,\n      framerate: 30,\n      bitrate: 1_500_000,\n      onStatusUpdate: (msg, isError) => {\n        this.localParticipant.setConnectionStatus(\n          isError ? \"failed\" : \"connected\"\n        );\n      },\n      onServerEvent: async (event) => {\n        await this._handleServerEvent(event);\n      },\n    });\n\n    // Setup stream event forwarding\n    publisher.on(\"localStreamReady\", (data) => {\n      this.emit(\"localStreamReady\", {\n        ...data,\n        participant: this.localParticipant.getInfo(),\n        roomId: this.id,\n      });\n    });\n\n    await publisher.startPublishing();\n    this.localParticipant.setPublisher(publisher);\n  }\n\n  /**\n   * Setup subscriber for remote participant\n   */\n  async _setupRemoteSubscriber(participant) {\n    const subscriber = new Subscriber({\n      streamId: participant.streamId,\n      roomId: this.id,\n      host: this.mediaConfig.host,\n      streamOutputEnabled: true,\n      onStatus: (msg, isError) => {\n        participant.setConnectionStatus(isError ? \"failed\" : \"connected\");\n      },\n      audioWorkletUrl: \"workers/audio-worklet1.js\",\n      mstgPolyfillUrl: \"polyfills/MSTG_polyfill.js\",\n    });\n    // Add to audio mixer\n    if (this.audioMixer) {\n      subscriber.setAudioMixer(this.audioMixer);\n    }\n\n    // Setup stream event forwarding\n    subscriber.on(\"remoteStreamReady\", (data) => {\n      this.emit(\"remoteStreamReady\", {\n        ...data,\n        participant: participant.getInfo(),\n        roomId: this.id,\n      });\n    });\n\n    // subscriber.on(\"streamRemoved\", (data) => {\n    //   this.emit(\"streamRemoved\", {\n    //     ...data,\n    //     participant: participant.getInfo(),\n    //     roomId: this.id\n    //   });\n    // });\n\n    await subscriber.start();\n    participant.setSubscriber(subscriber);\n  }\n\n  /**\n   * Handle server events from publisher\n   */\n  async _handleServerEvent(event) {\n    console.log(\"-----Received server event----\", event);\n    if (event.type === \"join\") {\n      const joinedParticipant = event.participant;\n      if (joinedParticipant.user_id === this.localParticipant?.userId) return;\n\n      const participant = this.addParticipant(\n        {\n          user_id: joinedParticipant.user_id,\n          stream_id: joinedParticipant.stream_id,\n          id: joinedParticipant.membership_id,\n          role: joinedParticipant.role,\n        },\n        this.localParticipant?.userId\n      );\n\n      await this._setupRemoteSubscriber(participant);\n    }\n\n    if (event.type === \"leave\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        this.removeParticipant(event.participant.user_id);\n\n        if (!this.pinnedParticipant && this.localParticipant) {\n          this.pinParticipant(this.localParticipant.userId);\n        }\n      }\n    }\n\n    if (event.type === \"message\") {\n      const message = {\n        id: event.id,\n        text: event.text,\n        senderId: event.senderId,\n        senderName: event.senderName,\n        roomId: event.roomId,\n        timestamp: event.timestamp,\n        metadata: event.metadata || {},\n      };\n\n      this.messages.push(message);\n\n      const sender = this.getParticipant(event.senderId);\n\n      this.emit(\"messageReceived\", {\n        room: this,\n        message,\n        sender: sender ? sender.getInfo() : null,\n      });\n    }\n\n    if (event.type === \"messageDelete\") {\n      this.messages = this.messages.filter((m) => m.id !== event.messageId);\n\n      this.emit(\"messageDeleted\", {\n        room: this,\n        messageId: event.messageId,\n        senderId: event.senderId,\n      });\n    }\n\n    if (event.type === \"messageUpdate\") {\n      const messageIndex = this.messages.findIndex((m) => m.id === event.messageId);\n      if (messageIndex !== -1) {\n        this.messages[messageIndex].text = event.text;\n        this.messages[messageIndex].updatedAt = event.timestamp;\n        this.messages[messageIndex].metadata = {\n          ...this.messages[messageIndex].metadata,\n          ...event.metadata,\n        };\n      }\n\n      this.emit(\"messageUpdated\", {\n        room: this,\n        messageId: event.messageId,\n        text: event.text,\n        senderId: event.senderId,\n      });\n    }\n\n    if (event.type === \"typingStart\") {\n      if (event.userId !== this.localParticipant?.userId) {\n        this.typingUsers.set(event.userId, {\n          userId: event.userId,\n          timestamp: event.timestamp,\n        });\n\n        this.emit(\"typingStarted\", {\n          room: this,\n          userId: event.userId,\n          user: this.getParticipant(event.userId)?.getInfo(),\n        });\n\n        setTimeout(() => {\n          this.typingUsers.delete(event.userId);\n          this.emit(\"typingStopped\", {\n            room: this,\n            userId: event.userId,\n          });\n        }, 5000);\n      }\n    }\n\n    if (event.type === \"typingStop\") {\n      if (event.userId !== this.localParticipant?.userId) {\n        this.typingUsers.delete(event.userId);\n\n        this.emit(\"typingStopped\", {\n          room: this,\n          userId: event.userId,\n          user: this.getParticipant(event.userId)?.getInfo(),\n        });\n      }\n    }\n    if (event.type === \"start_share_screen\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant && participant.userId !== this.localParticipant?.userId) {\n        participant.isScreenSharing = true;\n        this.emit(\"remoteScreenShareStarted\", { room: this, participant });\n      }\n    }\n\n    if (event.type === \"stop_share_screen\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant && participant.userId !== this.localParticipant?.userId) {\n        participant.isScreenSharing = false;\n        this.emit(\"remoteScreenShareStopped\", { room: this, participant });\n      }\n    }\n\n    if (event.type === \"mic_on\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        participant.updateMicStatus(true);\n        this.emit(\"remoteAudioStatusChanged\", {\n          room: this,\n          participant,\n          enabled: true,\n        });\n      }\n    }\n\n    if (event.type === \"mic_off\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        participant.updateMicStatus(false);\n        this.emit(\"remoteAudioStatusChanged\", {\n          room: this,\n          participant,\n          enabled: false,\n        });\n      }\n    }\n\n    if (event.type === \"camera_on\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        participant.updateCameraStatus(true);\n        this.emit(\"remoteVideoStatusChanged\", {\n          room: this,\n          participant,\n          enabled: true,\n        });\n      }\n    }\n\n    if (event.type === \"camera_off\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        participant.updateCameraStatus(false);\n        this.emit(\"remoteVideoStatusChanged\", {\n          room: this,\n          participant,\n          enabled: false,\n        });\n      }\n    }\n\n    if (event.type === \"pin_for_everyone\") {\n      console.log(`Pin for everyone event received:`, event.participant);\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        this.pinParticipant(participant.userId);\n        this.emit(\"participantPinnedForEveryone\", { room: this, participant });\n      }\n    }\n\n    if (event.type === \"unpin_for_everyone\") {\n      console.log(`Unpin for everyone event received`);\n      if (this.pinnedParticipant) {\n        const participant = this.pinnedParticipant;\n        this.unpinParticipant();\n        this.emit(\"participantUnpinnedForEveryone\", {\n          room: this,\n          participant,\n        });\n      }\n    }\n\n    if (event.type === \"raise_hand\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        participant.updateHandRaiseStatus(true);\n        this.emit(\"remoteHandRaisingStatusChanged\", {\n          room: this,\n          participant,\n          raised: true,\n        });\n      }\n    }\n\n    if (event.type === \"lower_hand\") {\n      const participant = this.participants.get(event.participant.user_id);\n      if (participant) {\n        participant.updateHandRaiseStatus(false);\n        this.emit(\"remoteHandRaisingStatusChanged\", {\n          room: this,\n          participant,\n          raised: false,\n        });\n      }\n    }\n  }\n\n  _setupParticipantEvents(participant) {\n    participant.on(\"pinToggled\", ({ participant: p, pinned }) => {\n      if (pinned) {\n        this.pinParticipant(p.userId);\n      } else if (this.pinnedParticipant === p) {\n        this.unpinParticipant();\n      }\n    });\n\n    participant.on(\"audioToggled\", ({ participant: p, enabled }) => {\n      this.emit(\"audioToggled\", {\n        room: this,\n        participant: p,\n        enabled,\n      });\n    });\n\n    participant.on(\"videoToggled\", ({ participant: p, enabled }) => {\n      this.emit(\"videoToggled\", {\n        room: this,\n        participant: p,\n        enabled,\n      });\n    });\n\n    participant.on(\"handRaiseToggled\", ({ participant: p, enabled }) => {\n      this.emit(\"handRaiseToggled\", {\n        room: this,\n        participant: p,\n        enabled,\n      });\n    });\n\n    participant.on(\"error\", ({ participant: p, error, action }) => {\n      this.emit(\"participantError\", {\n        room: this,\n        participant: p,\n        error,\n        action,\n      });\n    });\n  }\n\n  /**\n   * Update room data from API response\n   */\n  _updateFromApiData(roomData) {\n    this.name = roomData.room_name || this.name;\n    this.ownerId = roomData.user_id || this.ownerId;\n  }\n\n  /**\n   * Cleanup media connections\n   */\n  async _cleanupMediaConnections() {\n    // Cleanup audio mixer\n    if (this.audioMixer) {\n      await this.audioMixer.cleanup();\n      this.audioMixer = null;\n    }\n\n    // Cleanup all participants' media\n    for (const participant of this.participants.values()) {\n      if (participant.publisher) {\n        participant.publisher.stop();\n        participant.publisher = null;\n      }\n      if (participant.subscriber) {\n        participant.subscriber.stop();\n        participant.subscriber = null;\n      }\n    }\n  }\n\n  /**\n   * Cleanup all participants\n   */\n  _cleanupParticipants() {\n    for (const participant of this.participants.values()) {\n      participant.cleanup();\n    }\n\n    this.participants.clear();\n    this.localParticipant = null;\n    this.pinnedParticipant = null;\n    this.typingUsers.clear();\n  }\n\n  _generateMessageId() {\n    return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Setup stream event forwarding for existing participants\n   */\n  _setupStreamEventForwarding() {\n    // Setup for local participant if exists\n    if (this.localParticipant && this.localParticipant.publisher) {\n      this.localParticipant.publisher.on(\"localStreamReady\", (data) => {\n        this.emit(\"localStreamReady\", {\n          ...data,\n          participant: this.localParticipant.getInfo(),\n          roomId: this.id,\n        });\n      });\n    }\n\n    // Setup for remote participants\n    for (const participant of this.participants.values()) {\n      if (participant.subscriber && !participant.isLocal) {\n        participant.subscriber.on(\"remoteStreamReady\", (data) => {\n          this.emit(\"remoteStreamReady\", {\n            ...data,\n            participant: participant.getInfo(),\n            roomId: this.id,\n          });\n        });\n\n        // participant.subscriber.on(\"streamRemoved\", (data) => {\n        //   this.emit(\"streamRemoved\", {\n        //     ...data,\n        //     participant: participant.getInfo(),\n        //     roomId: this.id\n        //   });\n        // });\n      }\n    }\n  }\n\n  /**\n   * Remove stream event forwarding\n   */\n  _removeStreamEventForwarding() {\n    // Remove local participant events\n    if (this.localParticipant && this.localParticipant.publisher) {\n      this.localParticipant.publisher.removeAllListeners(\"localStreamReady\");\n    }\n\n    // Remove remote participants events\n    for (const participant of this.participants.values()) {\n      if (participant.subscriber && !participant.isLocal) {\n        participant.subscriber.removeAllListeners(\"remoteStreamReady\");\n        participant.subscriber.removeAllListeners(\"streamRemoved\");\n      }\n    }\n  }\n\n  /**\n   * Cleanup room resources\n   */\n  async cleanup() {\n    if (this.isActive) {\n      await this.leave();\n    }\n\n    // Cleanup sub rooms\n    for (const subRoom of this.subRooms.values()) {\n      await subRoom.cleanup();\n    }\n    this.subRooms.clear();\n\n    this.removeAllListeners();\n  }\n}\n\nexport default Room;\n","import Room from \"./Room.js\";\n\n/**\n * SubRoom extends Room with additional functionality for breakout rooms\n */\nclass SubRoom extends Room {\n  constructor(config) {\n    super({\n      ...config,\n      type: config.type || \"breakout\",\n    });\n\n    this.parentRoom = config.parentRoom; // Reference to parent Room instance\n    this.maxParticipants = config.maxParticipants || 10;\n    this.autoReturn = config.autoReturn || false; // Auto return to main room when empty\n    this.duration = config.duration || null; // Duration in minutes, null = unlimited\n    this.startTime = null;\n\n    // Sub room specific state\n    this.isTemporary = config.isTemporary || true;\n    this.allowSelfAssign = config.allowSelfAssign || true;\n\n    this._setupSubRoomEvents();\n  }\n\n  /**\n   * Join the sub room from main room\n   */\n  async joinFromMain(userId) {\n    if (!this.parentRoom) {\n      throw new Error(\"No parent room reference\");\n    }\n\n    try {\n      this.emit(\"joiningFromMain\", { subRoom: this, userId });\n\n      // Pause main room media without leaving\n      await this.parentRoom._pauseMediaConnections();\n\n      // Join this sub room\n      const joinResult = await this.join(userId);\n\n      // Start duration timer if set\n      if (this.duration && !this.startTime) {\n        this.startTime = Date.now();\n        this._startDurationTimer();\n      }\n\n      this.emit(\"joinedFromMain\", { subRoom: this, userId, joinResult });\n\n      return joinResult;\n    } catch (error) {\n      // Resume main room media on error\n      if (this.parentRoom) {\n        await this.parentRoom._resumeMediaConnections();\n      }\n\n      this.emit(\"error\", { subRoom: this, error, action: \"joinFromMain\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Return to main room\n   */\n  async returnToMainRoom() {\n    if (!this.parentRoom) {\n      throw new Error(\"No parent room reference\");\n    }\n\n    try {\n      this.emit(\"returningToMain\", { subRoom: this });\n\n      // Leave sub room\n      await this.leave();\n\n      // Resume main room media\n      await this.parentRoom._resumeMediaConnections();\n\n      this.emit(\"returnedToMain\", { subRoom: this });\n\n      // Check if should cleanup empty room\n      if (this.participants.size === 0 && this.autoReturn) {\n        await this.cleanup();\n      }\n\n      return this.parentRoom;\n    } catch (error) {\n      this.emit(\"error\", { subRoom: this, error, action: \"returnToMainRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Switch to another sub room directly\n   */\n  async switchToSubRoom(targetSubRoom) {\n    if (!this.parentRoom) {\n      throw new Error(\"No parent room reference\");\n    }\n\n    try {\n      this.emit(\"switchingToSubRoom\", {\n        fromSubRoom: this,\n        toSubRoom: targetSubRoom,\n      });\n\n      // Leave current sub room\n      await this.leave();\n\n      // Join target sub room\n      const joinResult = await targetSubRoom.joinFromMain(\n        this.localParticipant?.userId\n      );\n\n      this.emit(\"switchedToSubRoom\", {\n        fromSubRoom: this,\n        toSubRoom: targetSubRoom,\n      });\n\n      return joinResult;\n    } catch (error) {\n      this.emit(\"error\", { subRoom: this, error, action: \"switchToSubRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Invite participant to this sub room\n   */\n  async inviteParticipant(userId) {\n    try {\n      // Send invitation via API (implementation depends on API support)\n      const result = await this.apiClient.inviteToSubRoom(this.id, userId);\n\n      this.emit(\"participantInvited\", { subRoom: this, userId, result });\n\n      return result;\n    } catch (error) {\n      this.emit(\"error\", { subRoom: this, error, action: \"inviteParticipant\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Assign participant to this sub room (host action)\n   */\n  async assignParticipant(userId) {\n    try {\n      // Force assignment via API\n      const result = await this.apiClient.assignToSubRoom(this.id, userId);\n\n      this.emit(\"participantAssigned\", { subRoom: this, userId, result });\n\n      return result;\n    } catch (error) {\n      this.emit(\"error\", { subRoom: this, error, action: \"assignParticipant\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Broadcast message to all participants\n   */\n  async broadcastMessage(message, type = \"info\") {\n    try {\n      const result = await this.apiClient.broadcastToSubRoom(\n        this.id,\n        message,\n        type\n      );\n\n      this.emit(\"messageBroadcast\", { subRoom: this, message, type, result });\n\n      return result;\n    } catch (error) {\n      this.emit(\"error\", { subRoom: this, error, action: \"broadcastMessage\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Get remaining time in minutes\n   */\n  getRemainingTime() {\n    if (!this.duration || !this.startTime) {\n      return null;\n    }\n\n    const elapsed = (Date.now() - this.startTime) / (1000 * 60); // in minutes\n    const remaining = Math.max(0, this.duration - elapsed);\n\n    return Math.ceil(remaining);\n  }\n\n  /**\n   * Extend sub room duration\n   */\n  extendDuration(additionalMinutes) {\n    if (!this.duration) {\n      this.duration = additionalMinutes;\n      this.startTime = Date.now();\n    } else {\n      this.duration += additionalMinutes;\n    }\n\n    this.emit(\"durationExtended\", {\n      subRoom: this,\n      additionalMinutes,\n      newDuration: this.duration,\n    });\n\n    // Restart timer if needed\n    if (this.startTime) {\n      this._startDurationTimer();\n    }\n  }\n\n  /**\n   * Set participant limit\n   */\n  setMaxParticipants(limit) {\n    this.maxParticipants = limit;\n\n    this.emit(\"maxParticipantsChanged\", {\n      subRoom: this,\n      maxParticipants: limit,\n    });\n\n    // If over limit, may need to handle overflow\n    if (this.participants.size > limit) {\n      this.emit(\"participantLimitExceeded\", {\n        subRoom: this,\n        current: this.participants.size,\n        limit,\n      });\n    }\n  }\n\n  /**\n   * Check if sub room is full\n   */\n  isFull() {\n    return this.participants.size >= this.maxParticipants;\n  }\n\n  /**\n   * Check if sub room is empty\n   */\n  isEmpty() {\n    return this.participants.size === 0;\n  }\n\n  /**\n   * Check if sub room has expired\n   */\n  hasExpired() {\n    if (!this.duration || !this.startTime) {\n      return false;\n    }\n\n    const elapsed = (Date.now() - this.startTime) / (1000 * 60);\n    return elapsed >= this.duration;\n  }\n\n  /**\n   * Get sub room statistics\n   */\n  getStats() {\n    return {\n      ...this.getInfo(),\n      maxParticipants: this.maxParticipants,\n      duration: this.duration,\n      remainingTime: this.getRemainingTime(),\n      startTime: this.startTime,\n      isFull: this.isFull(),\n      isEmpty: this.isEmpty(),\n      hasExpired: this.hasExpired(),\n      isTemporary: this.isTemporary,\n      allowSelfAssign: this.allowSelfAssign,\n      autoReturn: this.autoReturn,\n    };\n  }\n\n  /**\n   * Setup sub room specific events\n   */\n  _setupSubRoomEvents() {\n    // Handle participant left\n    this.on(\"participantRemoved\", ({ room, participant }) => {\n      // Auto return to main room if empty and configured to do so\n      if (this.isEmpty() && this.autoReturn && this.parentRoom) {\n        setTimeout(() => {\n          if (this.isEmpty()) {\n            // Double check after delay\n            this.cleanup();\n          }\n        }, 5000); // 5 second delay\n      }\n    });\n\n    // Handle room expiry warnings\n    if (this.duration) {\n      // Warn 5 minutes before expiry\n      const warningTime = Math.max(1, this.duration - 5);\n      setTimeout(() => {\n        if (this.isActive && !this.hasExpired()) {\n          this.emit(\"expiryWarning\", { subRoom: this, remainingMinutes: 5 });\n        }\n      }, warningTime * 60 * 1000);\n    }\n  }\n\n  /**\n   * Start duration timer for automatic closure\n   */\n  _startDurationTimer() {\n    if (this._durationTimer) {\n      clearTimeout(this._durationTimer);\n    }\n\n    if (!this.duration) return;\n\n    const remainingMs = this.getRemainingTime() * 60 * 1000;\n\n    if (remainingMs <= 0) {\n      this._handleExpiry();\n      return;\n    }\n\n    this._durationTimer = setTimeout(() => {\n      this._handleExpiry();\n    }, remainingMs);\n  }\n\n  /**\n   * Handle sub room expiry\n   */\n  async _handleExpiry() {\n    this.emit(\"expired\", { subRoom: this });\n\n    // Notify all participants\n    await this.broadcastMessage(\n      \"Sub room session has expired. Returning to main room.\",\n      \"warning\"\n    );\n\n    // Return all participants to main room\n    const participants = Array.from(this.participants.values());\n    for (const participant of participants) {\n      if (participant.isLocal) {\n        await this.returnToMainRoom();\n      }\n    }\n\n    // Cleanup sub room\n    await this.cleanup();\n  }\n\n  /**\n   * Override cleanup to clear timers\n   */\n  async cleanup() {\n    // Clear duration timer\n    if (this._durationTimer) {\n      clearTimeout(this._durationTimer);\n      this._durationTimer = null;\n    }\n\n    // Remove from parent room's sub rooms map\n    if (this.parentRoom) {\n      this.parentRoom.subRooms.delete(this.id);\n    }\n\n    // Call parent cleanup\n    await super.cleanup();\n\n    this.emit(\"cleanedUp\", { subRoom: this });\n  }\n\n  /**\n   * Serialize sub room state for persistence or transfer\n   */\n  serialize() {\n    return {\n      ...this.getStats(),\n      participantIds: Array.from(this.participants.keys()),\n      parentRoomId: this.parentRoom?.id || this.parentRoomId,\n      createdAt: this.startTime || Date.now(),\n    };\n  }\n\n  /**\n   * Create sub room from serialized data\n   */\n  static fromSerializedData(data, parentRoom, apiClient, mediaConfig) {\n    return new SubRoom({\n      id: data.id,\n      name: data.name,\n      code: data.code,\n      type: data.type,\n      parentRoom,\n      parentRoomId: data.parentRoomId,\n      ownerId: data.ownerId,\n      maxParticipants: data.maxParticipants,\n      duration: data.duration,\n      autoReturn: data.autoReturn,\n      isTemporary: data.isTemporary,\n      allowSelfAssign: data.allowSelfAssign,\n      apiClient,\n      mediaConfig,\n    });\n  }\n}\n\nexport default SubRoom;\n","import EventEmitter from \"../events/EventEmitter.js\";\nimport ApiClient from \"../api/ApiClient.js\";\nimport Room from \"./Room.js\";\nimport SubRoom from \"./SubRoom.js\";\n\n/**\n * Main Ermis Classroom client\n */\nclass ErmisClient extends EventEmitter {\n  constructor(config = {}) {\n    super();\n\n    // Configuration\n    this.config = {\n      host: config.host || \"daibo.ermis.network:9992\",\n      apiUrl:\n        config.apiUrl ||\n        `https://${config.host || \"daibo.ermis.network:9992\"}/meeting`,\n      webtpUrl:\n        config.webtpUrl || \"https://daibo.ermis.network:4458/meeting/wt\",\n      reconnectAttempts: config.reconnectAttempts || 3,\n      reconnectDelay: config.reconnectDelay || 2000,\n      debug: config.debug || false,\n    };\n\n    // API client\n    this.apiClient = new ApiClient({\n      host: this.config.host,\n      apiUrl: this.config.apiUrl,\n    });\n\n    // State management\n    this.state = {\n      user: null,\n      isAuthenticated: false,\n      currentRoom: null,\n      rooms: new Map(), // roomId -> Room\n      connectionStatus: \"disconnected\", // 'disconnected', 'connecting', 'connected', 'failed'\n    };\n\n    // Media configuration\n    this.mediaConfig = {\n      host: this.config.host,\n      webtpUrl: this.config.webtpUrl,\n      defaultVideoConfig: {\n        width: 1280,\n        height: 720,\n        framerate: 30,\n        bitrate: 1_500_000,\n      },\n      defaultAudioConfig: {\n        sampleRate: 48000,\n        channels: 2,\n      },\n    };\n\n    this._setupEventHandlers();\n  }\n\n  /**\n   * Authenticate user\n   */\n  async authenticate(userId) {\n    if (this.state.isAuthenticated && this.state.user?.id === userId) {\n      return this.state.user;\n    }\n\n    try {\n      this.emit(\"authenticating\", { userId });\n      this._setConnectionStatus(\"connecting\");\n\n      // Validate email format if it looks like email\n      if (userId.includes(\"@\")) {\n        const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n        if (!emailRegex.test(userId)) {\n          throw new Error(\"Invalid email format\");\n        }\n      }\n\n      // Get authentication token\n      const tokenResponse = await this.apiClient.getDummyToken(userId);\n\n      // Set authentication in API client\n      this.apiClient.setAuth(tokenResponse.access_token, userId);\n\n      // Update state\n      this.state.user = {\n        id: userId,\n        token: tokenResponse.access_token,\n        authenticatedAt: Date.now(),\n      };\n      this.state.isAuthenticated = true;\n\n      this._setConnectionStatus(\"connected\");\n      this.emit(\"authenticated\", { user: this.state.user });\n\n      this._debug(\"User authenticated successfully:\", userId);\n\n      return this.state.user;\n    } catch (error) {\n      this._setConnectionStatus(\"failed\");\n      this.emit(\"authenticationFailed\", { userId, error });\n      this._debug(\"Authentication failed:\", error);\n      throw error;\n    }\n  }\n\n  /**\n * Set authentication directly without calling API\n */\n  manualAuthenticate(userId, token) {\n    if (!userId || !token) {\n      throw new Error(\"userId and token are required\");\n    }\n\n    // Set auth to API client\n    this.apiClient.setAuth(token, userId);\n\n    // Update state\n    this.state.user = {\n      id: userId,\n      token,\n      authenticatedAt: Date.now(),\n    };\n    this.state.isAuthenticated = true;\n\n    // Update connection status\n    this._setConnectionStatus(\"connected\");\n\n    // Emit event\n    this.emit(\"authenticated\", { user: this.state.user });\n\n    this._debug(\"Auth set directly:\", this.state.user);\n  }\n\n  /**\n   * Logout user\n   */\n  async logout() {\n    if (!this.state.isAuthenticated) {\n      return;\n    }\n\n    try {\n      this.emit(\"loggingOut\", { user: this.state.user });\n\n      // Leave current room if any\n      if (this.state.currentRoom) {\n        await this.state.currentRoom.leave();\n      }\n\n      // Reset state\n      this.state.user = null;\n      this.state.isAuthenticated = false;\n      this.state.currentRoom = null;\n      this.state.rooms.clear();\n\n      this._setConnectionStatus(\"disconnected\");\n      this.emit(\"loggedOut\");\n\n      this._debug(\"User logged out successfully\");\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"logout\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Create a new room\n   */\n  async createRoom(config) {\n    this._ensureAuthenticated();\n\n    try {\n      this.emit(\"creatingRoom\", { config });\n\n      const roomData = await this.apiClient.createRoom(\n        config.name,\n        config.type\n      );\n\n      const room = new Room({\n        id: roomData.id,\n        name: roomData.room_name,\n        code: roomData.room_code,\n        type: config.type || \"main\",\n        ownerId: roomData.user_id,\n        apiClient: this.apiClient,\n        mediaConfig: this.mediaConfig,\n      });\n\n      this._setupRoomEvents(room);\n      this.state.rooms.set(room.id, room);\n\n      this.emit(\"roomCreated\", { room });\n      this._debug(\"Room created:\", room.getInfo());\n\n      // Auto-join if specified\n      if (config.autoJoin !== false) {\n        await this.joinRoom(room.code);\n      }\n\n      return room;\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"createRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Join a room by code\n   */\n  async joinRoom(roomCode) {\n    this._ensureAuthenticated();\n\n    try {\n      this.emit(\"joiningRoom\", { roomCode });\n\n      // Leave current room if any\n      if (this.state.currentRoom) {\n        await this.state.currentRoom.leave();\n      }\n\n      // Try to find existing room instance first\n      let room = Array.from(this.state.rooms.values()).find(\n        (r) => r.code === roomCode\n      );\n\n      if (!room) {\n        // Create new room instance\n        room = new Room({\n          code: roomCode,\n          apiClient: this.apiClient,\n          mediaConfig: this.mediaConfig,\n        });\n\n        this._setupRoomEvents(room);\n      }\n\n      // Join the room\n      const joinResult = await room.join(this.state.user.id);\n\n      // Update state\n      this.state.currentRoom = room;\n      this.state.rooms.set(room.id, room);\n\n      this.emit(\"roomJoined\", { room, joinResult });\n      this._debug(\"Joined room:\", room.getInfo());\n\n      return joinResult;\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"joinRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Leave current room\n   */\n  async leaveRoom() {\n    if (!this.state.currentRoom) {\n      return;\n    }\n\n    try {\n      const room = this.state.currentRoom;\n      this.emit(\"leavingRoom\", { room });\n\n      await room.leave();\n\n      this.state.currentRoom = null;\n\n      this.emit(\"roomLeft\", { room });\n      this._debug(\"Left room:\", room.getInfo());\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"leaveRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Get available rooms\n   */\n  async getRooms(options = {}) {\n    this._ensureAuthenticated();\n\n    try {\n      const response = await this.apiClient.listRooms(\n        options.page || 1,\n        options.perPage || 20\n      );\n\n      this.emit(\"roomsLoaded\", { rooms: response.data || [] });\n\n      return response.data || [];\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"getRooms\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Get current room\n   */\n  getCurrentRoom() {\n    return this.state.currentRoom;\n  }\n\n  /**\n   * Get room by ID\n   */\n  getRoom(roomId) {\n    return this.state.rooms.get(roomId);\n  }\n\n  /**\n   * Create sub room in current room\n   */\n  async createSubRoom(config) {\n    if (!this.state.currentRoom) {\n      throw new Error(\"Must be in a main room to create sub rooms\");\n    }\n\n    if (this.state.currentRoom.type !== \"main\") {\n      throw new Error(\"Can only create sub rooms from main rooms\");\n    }\n\n    try {\n      this.emit(\"creatingSubRoom\", {\n        config,\n        parentRoom: this.state.currentRoom,\n      });\n\n      const subRoom = await this.state.currentRoom.createSubRoom(config);\n\n      this.emit(\"subRoomCreated\", {\n        subRoom,\n        parentRoom: this.state.currentRoom,\n      });\n      this._debug(\"Sub room created:\", subRoom.getInfo());\n\n      return subRoom;\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"createSubRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Join a sub room\n   */\n  async joinSubRoom(subRoomCode) {\n    if (!this.state.currentRoom) {\n      throw new Error(\"Must be in a main room to join sub rooms\");\n    }\n\n    try {\n      this.emit(\"joiningSubRoom\", {\n        subRoomCode,\n        parentRoom: this.state.currentRoom,\n      });\n\n      // Find sub room\n      const subRooms = await this.state.currentRoom.getSubRooms();\n      const subRoom = subRooms.find((sr) => sr.code === subRoomCode);\n\n      if (!subRoom) {\n        throw new Error(`Sub room with code ${subRoomCode} not found`);\n      }\n\n      // Join sub room\n      const joinResult = await subRoom.joinFromMain(this.state.user.id);\n\n      this.emit(\"subRoomJoined\", {\n        subRoom,\n        parentRoom: this.state.currentRoom,\n      });\n      this._debug(\"Joined sub room:\", subRoom.getInfo());\n\n      return joinResult;\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"joinSubRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Return to main room from sub room\n   */\n  async returnToMainRoom() {\n    if (!this.state.currentRoom || this.state.currentRoom.type !== \"breakout\") {\n      throw new Error(\"Must be in a sub room to return to main room\");\n    }\n\n    try {\n      this.emit(\"returningToMainRoom\", { subRoom: this.state.currentRoom });\n\n      const subRoom = this.state.currentRoom;\n      const mainRoom = await subRoom.returnToMainRoom();\n\n      this.state.currentRoom = mainRoom;\n\n      this.emit(\"returnedToMainRoom\", { mainRoom, previousSubRoom: subRoom });\n      this._debug(\"Returned to main room from sub room\");\n\n      return mainRoom;\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"returnToMainRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Switch between sub rooms\n   */\n  async switchSubRoom(targetSubRoomCode) {\n    if (!this.state.currentRoom || this.state.currentRoom.type !== \"breakout\") {\n      throw new Error(\"Must be in a sub room to switch to another sub room\");\n    }\n\n    try {\n      this.emit(\"switchingSubRoom\", {\n        fromSubRoom: this.state.currentRoom,\n        targetSubRoomCode,\n      });\n\n      const currentSubRoom = this.state.currentRoom;\n      const parentRoom = currentSubRoom.parentRoom;\n\n      // Find target sub room\n      const subRooms = await parentRoom.getSubRooms();\n      const targetSubRoom = subRooms.find(\n        (sr) => sr.code === targetSubRoomCode\n      );\n\n      if (!targetSubRoom) {\n        throw new Error(`Sub room with code ${targetSubRoomCode} not found`);\n      }\n\n      // Switch to target sub room\n      const joinResult = await currentSubRoom.switchToSubRoom(targetSubRoom);\n\n      this.state.currentRoom = targetSubRoom;\n\n      this.emit(\"subRoomSwitched\", {\n        fromSubRoom: currentSubRoom,\n        toSubRoom: targetSubRoom,\n      });\n      this._debug(\"Switched sub rooms:\", {\n        from: currentSubRoom.getInfo(),\n        to: targetSubRoom.getInfo(),\n      });\n\n      return joinResult;\n    } catch (error) {\n      this.emit(\"error\", { error, action: \"switchSubRoom\" });\n      throw error;\n    }\n  }\n\n  /**\n   * Get client state\n   */\n  getState() {\n    return {\n      user: this.state.user,\n      isAuthenticated: this.state.isAuthenticated,\n      currentRoom: this.state.currentRoom?.getInfo() || null,\n      connectionStatus: this.state.connectionStatus,\n      roomCount: this.state.rooms.size,\n    };\n  }\n\n  /**\n   * Get client configuration\n   */\n  getConfig() {\n    return { ...this.config };\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n\n    // Update API client if needed\n    if (newConfig.host || newConfig.apiUrl) {\n      this.apiClient = new ApiClient({\n        host: this.config.host,\n        apiUrl: this.config.apiUrl,\n      });\n\n      if (this.state.isAuthenticated) {\n        this.apiClient.setAuth(this.state.user.token, this.state.user.id);\n      }\n    }\n\n    this.emit(\"configUpdated\", { config: this.config });\n  }\n\n  /**\n   * Enable debug mode\n   */\n  enableDebug() {\n    this.config.debug = true;\n    this._debug(\"Debug mode enabled\");\n  }\n\n  /**\n   * Disable debug mode\n   */\n  disableDebug() {\n    this.config.debug = false;\n  }\n\n  async sendMessage(text, metadata = {}) {\n    if (!this.state.currentRoom) {\n      throw new Error(\"No active room. Join a room first.\");\n    }\n\n    return await this.state.currentRoom.sendMessage(text, metadata);\n  }\n\n  async deleteMessage(messageId) {\n    if (!this.state.currentRoom) {\n      throw new Error(\"No active room. Join a room first.\");\n    }\n\n    return await this.state.currentRoom.deleteMessage(messageId);\n  }\n\n  async updateMessage(messageId, newText, metadata = {}) {\n    if (!this.state.currentRoom) {\n      throw new Error(\"No active room. Join a room first.\");\n    }\n\n    return await this.state.currentRoom.updateMessage(messageId, newText, metadata);\n  }\n\n  async sendTypingIndicator(isTyping = true) {\n    if (!this.state.currentRoom) {\n      return;\n    }\n\n    return await this.state.currentRoom.sendTypingIndicator(isTyping);\n  }\n\n  getMessages(limit = 100) {\n    if (!this.state.currentRoom) {\n      return [];\n    }\n\n    return this.state.currentRoom.getMessages(limit);\n  }\n\n  getTypingUsers() {\n    if (!this.state.currentRoom) {\n      return [];\n    }\n\n    return this.state.currentRoom.getTypingUsers();\n  }\n\n  clearMessages() {\n    if (!this.state.currentRoom) {\n      return;\n    }\n\n    this.state.currentRoom.clearMessages();\n  }\n\n  /**\n   * Cleanup client resources\n   */\n  async cleanup() {\n    try {\n      // Leave current room\n      if (this.state.currentRoom) {\n        await this.state.currentRoom.leave();\n      }\n\n      // Cleanup all rooms\n      for (const room of this.state.rooms.values()) {\n        await room.cleanup();\n      }\n\n      // Clear state\n      this.state.rooms.clear();\n      this.state.currentRoom = null;\n\n      // Remove all listeners\n      this.removeAllListeners();\n\n      this._debug(\"Client cleanup completed\");\n    } catch (error) {\n      console.error(\"Error during cleanup:\", error);\n    }\n  }\n\n  /**\n   * Setup event handlers for rooms\n   */\n  _setupRoomEvents(room) {\n    // Forward room events to client\n    const eventsToForward = [\n      \"roomJoined\",\n      \"roomLeft\",\n      \"participantAdded\",\n      \"participantRemoved\",\n      \"participantPinned\",\n      \"participantUnpinned\",\n      \"participantPinnedForEveryone\",\n      \"participantUnpinnedForEveryone\",\n      \"subRoomCreated\",\n      \"localStreamReady\",\n      \"remoteStreamReady\",\n      \"streamRemoved\",\n      \"audioToggled\",\n      \"videoToggled\",\n      \"handRaiseToggled\",\n      \"remoteAudioStatusChanged\",\n      \"remoteVideoStatusChanged\",\n      \"remoteHandRaisingStatusChanged\",\n      \"remoteScreenShareStarted\",\n      \"remoteScreenShareStopped\",\n      \"messageSent\",\n      \"messageReceived\",\n      \"messageDeleted\",\n      \"messageUpdated\",\n      \"typingStarted\",\n      \"typingStopped\",\n      \"error\",\n    ];\n\n    eventsToForward.forEach((event) => {\n      room.on(event, (data) => {\n        this.emit(\n          event,\n          data\n        );\n      });\n    });\n  }\n\n  /**\n   * Setup initial event handlers\n   */\n  _setupEventHandlers() {\n    // Handle authentication token refresh\n    this.on(\"authenticated\", () => {\n      // Could implement token refresh logic here\n    });\n\n    // Handle connection status changes\n    this.on(\"connectionStatusChanged\", ({ status }) => {\n      if (status === \"failed\" && this.config.reconnectAttempts > 0) {\n        this._attemptReconnect();\n      }\n    });\n  }\n\n  /**\n   * Attempt to reconnect\n   */\n  async _attemptReconnect() {\n    let attempts = 0;\n\n    while (attempts < this.config.reconnectAttempts) {\n      try {\n        attempts++;\n        this._debug(\n          `Reconnection attempt ${attempts}/${this.config.reconnectAttempts}`\n        );\n\n        await new Promise((resolve) =>\n          setTimeout(resolve, this.config.reconnectDelay)\n        );\n\n        if (this.state.user) {\n          await this.authenticate(this.state.user.id);\n          this._debug(\"Reconnection successful\");\n          return;\n        }\n      } catch (error) {\n        this._debug(`Reconnection attempt ${attempts} failed:`, error.message);\n      }\n    }\n\n    this.emit(\"reconnectionFailed\");\n    this._debug(\"All reconnection attempts failed\");\n  }\n\n  /**\n   * Set connection status\n   */\n  _setConnectionStatus(status) {\n    if (this.state.connectionStatus !== status) {\n      this.state.connectionStatus = status;\n      this.emit(\"connectionStatusChanged\", { status });\n      this._debug(\"Connection status changed:\", status);\n    }\n  }\n\n  /**\n   * Ensure user is authenticated\n   */\n  _ensureAuthenticated() {\n    if (!this.state.isAuthenticated) {\n      throw new Error(\"User must be authenticated first\");\n    }\n  }\n\n  /**\n   * Debug logging\n   */\n  _debug(...args) {\n    if (this.config.debug) {\n      console.log(\"[ErmisClient]\", ...args);\n    }\n  }\n}\n\nexport default ErmisClient;\n","/**\n * Ermis Classroom SDK\n * Main entry point for the SDK\n */\n\nimport ErmisClient from \"./core/ErmisClient.js\";\nimport Room from \"./core/Room.js\";\nimport SubRoom from \"./core/SubRoom.js\";\nimport Participant from \"./core/Participant.js\";\nimport ApiClient from \"./api/ApiClient.js\";\nimport EventEmitter from \"./events/EventEmitter.js\";\n\n/**\n * SDK Version\n */\nexport const VERSION = \"1.0.0\";\n\n/**\n * Main SDK Class - Similar to LiveKit pattern\n */\nclass ErmisClassroom {\n  /**\n   * Create a new Ermis Classroom client\n   * @param {Object} config - Configuration options\n   * @returns {ErmisClient} - New client instance\n   */\n  static create(config = {}) {\n    return new ErmisClient(config);\n  }\n\n  /**\n   * Connect and authenticate user\n   * @param {string} serverUrl - Server URL\n   * @param {string} userId - User identifier\n   * @param {Object} options - Connection options\n   * @returns {Promise<ErmisClient>} - Connected client\n   */\n  static async connect(serverUrl, userId, options = {}) {\n    const config = {\n      host: serverUrl.replace(/^https?:\\/\\//, \"\"),\n      ...options,\n    };\n\n    const client = new ErmisClient(config);\n    await client.authenticate(userId);\n\n    return client;\n  }\n\n  /**\n   * Get SDK version\n   */\n  static get version() {\n    return VERSION;\n  }\n\n  /**\n   * Get available events\n   */\n  static get events() {\n    return {\n      // Client events\n      CLIENT_AUTHENTICATED: \"authenticated\",\n      CLIENT_AUTHENTICATION_FAILED: \"authenticationFailed\",\n      CLIENT_LOGGED_OUT: \"loggedOut\",\n      CLIENT_CONNECTION_STATUS_CHANGED: \"connectionStatusChanged\",\n\n      // Room events\n      ROOM_CREATED: \"roomCreated\",\n      ROOM_JOINED: \"roomJoined\",\n      ROOM_LEFT: \"roomLeft\",\n\n      // Participant events\n      PARTICIPANT_ADDED: \"participantAdded\",\n      PARTICIPANT_REMOVED: \"participantRemoved\",\n      PARTICIPANT_PINNED: \"participantPinned\",\n      PARTICIPANT_UNPINNED: \"participantUnpinned\",\n      AUDIO_TOGGLED: \"audioToggled\",\n      VIDEO_TOGGLED: \"videoToggled\",\n      HAND_RAISE_TOGGLED: \"handRaiseToggled\",\n\n      // Remote participant status events\n      REMOTE_AUDIO_STATUS_CHANGED: \"remoteAudioStatusChanged\",\n      REMOTE_VIDEO_STATUS_CHANGED: \"remoteVideoStatusChanged\",\n\n      // Hand raising events\n      REMOTE_HAND_RAISING_STATUS_CHANGED: \"remoteHandRaisingStatusChanged\",\n      // Screen sharing events\n      SCREEN_SHARE_STARTED: \"screenShareStarted\",\n      SCREEN_SHARE_STOPPED: \"screenShareStopped\",\n      REMOTE_SCREEN_SHARE_STARTED: \"remoteScreenShareStarted\",\n      REMOTE_SCREEN_SHARE_STOPPED: \"remoteScreenShareStopped\",\n\n      // Pin for everyone events\n      PARTICIPANT_PINNED_FOR_EVERYONE: \"participantPinnedForEveryone\",\n      PARTICIPANT_UNPINNED_FOR_EVERYONE: \"participantUnpinnedForEveryone\",\n\n\n      // Sub room events\n      SUB_ROOM_CREATED: \"subRoomCreated\",\n      SUB_ROOM_JOINED: \"subRoomJoined\",\n      SUB_ROOM_LEFT: \"subRoomLeft\",\n      SUB_ROOM_SWITCHED: \"subRoomSwitched\",\n\n      // Media stream events\n      LOCAL_STREAM_READY: \"localStreamReady\",\n      REMOTE_STREAM_READY: \"remoteStreamReady\",\n      STREAM_REMOVED: \"streamRemoved\",\n\n      // Chat events\n      MESSAGE_SENT: \"messageSent\",\n      MESSAGE_RECEIVED: \"messageReceived\",\n      MESSAGE_DELETED: \"messageDeleted\",\n      MESSAGE_UPDATED: \"messageUpdated\",\n      TYPING_STARTED: \"typingStarted\",\n      TYPING_STOPPED: \"typingStopped\",\n      CHAT_HISTORY_LOADED: \"chatHistoryLoaded\",\n\n      // Error events\n      ERROR: \"error\",\n    };\n  }\n\n  /**\n   * Media device utilities\n   */\n  static get MediaDevices() {\n    return {\n      /**\n       * Get available media devices\n       */\n      async getDevices() {\n        if (!navigator.mediaDevices?.enumerateDevices) {\n          throw new Error(\"Media devices not supported\");\n        }\n\n        const devices = await navigator.mediaDevices.enumerateDevices();\n\n        return {\n          cameras: devices.filter((d) => d.kind === \"videoinput\"),\n          microphones: devices.filter((d) => d.kind === \"audioinput\"),\n          speakers: devices.filter((d) => d.kind === \"audiooutput\"),\n        };\n      },\n\n      /**\n       * Get user media with constraints\n       */\n      async getUserMedia(constraints = { video: true, audio: true }) {\n        if (!navigator.mediaDevices?.getUserMedia) {\n          throw new Error(\"getUserMedia not supported\");\n        }\n\n        return await navigator.mediaDevices.getUserMedia(constraints);\n      },\n\n      /**\n       * Check for media permissions\n       */\n      async checkPermissions() {\n        const permissions = {};\n\n        if (navigator.permissions) {\n          try {\n            permissions.camera = await navigator.permissions.query({\n              name: \"camera\",\n            });\n            permissions.microphone = await navigator.permissions.query({\n              name: \"microphone\",\n            });\n          } catch (error) {\n            console.warn(\"Permission check failed:\", error);\n          }\n        }\n\n        return permissions;\n      },\n    };\n  }\n\n  /**\n   * Room types constants\n   */\n  static get RoomTypes() {\n    return {\n      MAIN: \"main\",\n      BREAKOUT: \"breakout\",\n      PRESENTATION: \"presentation\",\n      DISCUSSION: \"discussion\",\n    };\n  }\n\n  /**\n   * Connection status constants\n   */\n  static get ConnectionStatus() {\n    return {\n      DISCONNECTED: \"disconnected\",\n      CONNECTING: \"connecting\",\n      CONNECTED: \"connected\",\n      FAILED: \"failed\",\n    };\n  }\n\n  /**\n   * Participant roles constants\n   */\n  static get ParticipantRoles() {\n    return {\n      OWNER: \"owner\",\n      MODERATOR: \"moderator\",\n      PARTICIPANT: \"participant\",\n      OBSERVER: \"observer\",\n    };\n  }\n}\n\n/**\n * Named exports for individual classes\n */\nexport { ErmisClient, Room, SubRoom, Participant, ApiClient, EventEmitter };\n\n/**\n * Default export - Main SDK class\n */\nexport default ErmisClassroom;\n","let wasm;\n\nconst cachedTextDecoder = (typeof TextDecoder !== 'undefined' ? new TextDecoder('utf-8', { ignoreBOM: true, fatal: true }) : { decode: () => { throw Error('TextDecoder not available') } } );\n\nif (typeof TextDecoder !== 'undefined') { cachedTextDecoder.decode(); };\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\n\nlet WASM_VECTOR_LEN = 0;\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nconst WasmEncoderFinalization = (typeof FinalizationRegistry === 'undefined')\n    ? { register: () => {}, unregister: () => {} }\n    : new FinalizationRegistry(ptr => wasm.__wbg_wasmencoder_free(ptr >>> 0, 1));\n\nexport class WasmEncoder {\n\n    __destroy_into_raw() {\n        const ptr = this.__wbg_ptr;\n        this.__wbg_ptr = 0;\n        WasmEncoderFinalization.unregister(this);\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_wasmencoder_free(ptr, 0);\n    }\n    /**\n     * @param {Uint8Array} data\n     * @param {number} mtu\n     */\n    constructor(data, mtu) {\n        const ptr0 = passArray8ToWasm0(data, wasm.__wbindgen_malloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.wasmencoder_new(ptr0, len0, mtu);\n        this.__wbg_ptr = ret >>> 0;\n        WasmEncoderFinalization.register(this, this.__wbg_ptr, this);\n        return this;\n    }\n    /**\n     * @param {number} repair_packets_count\n     * @returns {Array<any>}\n     */\n    encode(repair_packets_count) {\n        const ret = wasm.wasmencoder_encode(this.__wbg_ptr, repair_packets_count);\n        return ret;\n    }\n    /**\n     * @returns {number}\n     */\n    getMTU() {\n        const ret = wasm.wasmencoder_getMTU(this.__wbg_ptr);\n        return ret;\n    }\n    /**\n     * @returns {Uint8Array}\n     */\n    getConfigBuffer() {\n        const ret = wasm.wasmencoder_getConfigBuffer(this.__wbg_ptr);\n        return ret;\n    }\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_buffer_609cc3eee51ed158 = function(arg0) {\n        const ret = arg0.buffer;\n        return ret;\n    };\n    imports.wbg.__wbg_length_a446193dc22c12f8 = function(arg0) {\n        const ret = arg0.length;\n        return ret;\n    };\n    imports.wbg.__wbg_new_78feb108b6472713 = function() {\n        const ret = new Array();\n        return ret;\n    };\n    imports.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function(arg0, arg1, arg2) {\n        const ret = new Uint8Array(arg0, arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_newwithlength_a381634e90c276d4 = function(arg0) {\n        const ret = new Uint8Array(arg0 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_push_737cfc8c1432c2c6 = function(arg0, arg1) {\n        const ret = arg0.push(arg1);\n        return ret;\n    };\n    imports.wbg.__wbg_set_65595bdd868b3009 = function(arg0, arg1, arg2) {\n        arg0.set(arg1, arg2 >>> 0);\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_0;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n    imports.wbg.__wbindgen_memory = function() {\n        const ret = wasm.memory;\n        return ret;\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n\n}\n\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedUint8ArrayMemory0 = null;\n\n\n    wasm.__wbindgen_start();\n    return wasm;\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('raptorq_wasm_bg.wasm', import.meta.url);\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync };\nexport default __wbg_init;\n"],"names":["EventEmitter$1","constructor","this","_events","Map","on","event","listener","has","set","get","push","off","listeners","index","indexOf","splice","length","delete","emit","args","forEach","error","once","onceWrapper","removeAllListeners","clear","listenerCount","ApiClient$1","config","host","apiBaseUrl","apiUrl","jwtToken","userId","setAuth","token","apiCall","endpoint","method","body","Error","options","headers","Authorization","JSON","stringify","response","fetch","ok","status","json","getDummyToken","sub","createRoom","roomName","roomType","room_name","room_type","listRooms","page","perPage","list_query","per_page","sort_by","sort_order","conditions","is_active","getRoomById","roomId","joinRoom","roomCode","appName","room_code","app_name","createSubRoom","parentRoomId","subRoomName","subRoomType","parent_room_id","getSubRooms","leaveRoom","membershipId","switchToSubRoom","subRoomCode","room_id","sub_room_code","getRoomMembers","updateRoom","updates","deleteRoom","Participant$1","EventEmitter","super","streamId","role","isLocal","isAudioEnabled","isVideoEnabled","isPinned","isHandRaised","publisher","subscriber","isScreenSharing","screenSubscriber","connectionStatus","getDisplayName","roleText","localText","toggleMicrophone","toggleMic","participant","enabled","action","toggleCamera","toggleRemoteAudio","toggleAudio","togglePin","switchBitrate","pinned","toggleRaiseHand","lowerHand","raiseHand","setConnectionStatus","_getStatusText","setPublisher","setSubscriber","updateMicStatus","updateCameraStatus","updateHandRaiseStatus","cleanup","stop","getInfo","Publisher","publishUrl","streamType","currentConfig","codec","width","height","framerate","bitrate","kSampleRate","opusBaseTime","opusSamplesSent","opusSamplesPerChunk","opusChunkCount","stream","audioProcessor","videoProcessor","webTransport","isChannelOpen","sequenceNumber","isPublishing","cameraEnabled","micEnabled","hasCamera","undefined","hasMic","onStatusUpdate","message","isError","onStreamStart","onStreamStop","onServerEvent","wasmInitialized","wasmInitializing","wasmInitPromise","initAudioRecorder","WasmEncoder","publishStreams","videoEncoders","eventStream","subStreams","name","channelName","init","loadAllDependencies","document","querySelector","Promise","resolve","reject","script","createElement","src","onload","onerror","head","appendChild","default","then","raptorq_wasm","catch","err","opusModule","import","Date","now","startPublishing","setupConnection","getMediaStream","startStreaming","turnOffCamera","turnOnCamera","turnOffMic","turnOnMic","sendMeetingEvent","pinForEveryone","targetStreamId","unpinForEveryone","eventType","eventMessage","type","sender_stream_id","timestamp","target_stream_id","sendEvent","constraints","audio","sampleRate","channelCount","echoCancellation","noiseSuppression","video","ideal","frameRate","navigator","mediaDevices","getUserMedia","getDisplayMedia","videoTrack","getVideoTracks","onended","videoOnlyStream","MediaStream","videoTracks","addTrack","initVideoEncoders","subStream","startsWith","encoder","VideoEncoder","output","chunk","metadata","handleVideoChunk","e","latencyMode","hardwareAcceleration","metadataReady","videoDecoderConfig","WebTransport","ready","createEventStream","createBidirectionalStream","readable","writer","writable","getWriter","reader","getReader","initData","TextEncoder","encode","sendOverEventStream","setupEventStreamReader","sendPublisherState","workerInterval","Worker","postMessage","interval","lastPingTime","onmessage","ping","value","done","read","msg","TextDecoder","decode","parse","data","bytes","len","out","Uint8Array","DataView","buffer","setUint32","write","eventData","eventJson","stateEvent","configSent","sendOverStream","setupStreamReader","frameBytes","streamData","startVideoCapture","startOpusAudioStreaming","encoderObj","configure","triggerWorker","track","MediaStreamTrackProcessor","frameCounter","cameraEncoders","Array","from","entries","filter","_","obj","result","frame","window","videoBaseTimestamp","close","keyFrame","i","quality","isLastEncoder","encodeQueueSize","frameToEncode","VideoFrame","audioTrack","getAudioTracks","audioRecorderOptions","encoderApplication","encoderComplexity","encoderFrameSize","timeSlice","audioRecorder","ondataavailable","typedArray","handleOpusAudioChunk","start","decoderConfig","codedWidth","codedHeight","description","sendStreamConfig","chunkData","ArrayBuffer","byteLength","copyTo","packet","createPacketWithHeader","dataArray","audioConfig","numberOfChannels","performance","audioStartPerfTime","Math","floor","mediaType","configPacket","vConfigUint8","vConfigBase64","uint8ArrayToBase64","aConfigBase64","adjustedTimestamp","safeTimestamp","MAX_TS","binary","subarray","String","fromCharCode","apply","btoa","startShareScreen","screenStream","startEvent","screenConfig","find","s","screenEncoder","handleScreenVideoChunk","encoderConfig","screenVideoEncoder","screenAudioRecorder","handleScreenAudioChunk","screenAudioBaseTime","screenAudioSamplesSent","screenVideoProcessor","stopShareScreen","screenBaseTimestamp","stopEvent","state","flush","getTracks","screenAudioConfig","sendScreenDecoderConfigs","hasAudio","videoReady","audioReady","videoConfig","isActive","streamInfo","activeStreams","keys","Subscriber$1","isOwnStream","mediaWorkerUrl","audioWorkletUrl","mstgPolyfillUrl","isStarted","worker","audioWorkletNode","videoGenerator","videoWriter","mediaStream","subscriberId","audioMixer","_updateConnectionStatus","channel","MessageChannel","_loadPolyfill","_initWorker","port2","_initAudioSystem","port1","_initVideoSystem","removeSubscriber","terminate","_cleanupVideoSystem","setAudioMixer","MediaStreamTrackGenerator","channelPort","_handleWorkerMessage","mediaUrl","port","reason","addSubscriber","bufferMs","isPlaying","newBufferSize","kind","releaseLock","channelData","timeStamp","audioEnabled","_handleVideoData","previousStatus","AudioMixer$1","audioContext","mixerNode","outputDestination","subscriberNodes","isInitialized","outputAudioElement","masterVolume","bufferSize","enableEchoCancellation","debug","initialize","_debug","AudioContext","webkitAudioContext","latencyHint","resume","createGain","gain","createMediaStreamDestination","connect","autoplay","style","display","setAttribute","_setupErrorHandlers","isOwnAudio","channelWorkletPort","_loadAudioWorklet","workletNode","AudioWorkletNode","numberOfInputs","numberOfOutputs","outputChannelCount","gainNode","addedAt","_updateOutputAudio","_setupWorkletMessageHandler","subscriberData","disconnect","setSubscriberVolume","volume","normalizedVolume","max","min","setSubscriberMuted","muted","setMasterVolume","getOutputMediaStream","getStats","subscriberCount","size","audioContextState","subscribers","map","id","getSubscriberIds","hasSubscriber","suspend","srcObject","parentNode","removeChild","audioWorklet","addModule","includes","onstatechange","addEventListener","async","hidden","_sleep","ms","setTimeout","Room","code","ownerId","apiClient","mediaConfig","participants","localParticipant","subRooms","pinnedParticipant","messages","typingUsers","join","room","joinResponse","stream_id","roomDetails","_updateFromApiData","_setupParticipants","_setupMediaConnections","values","leave","_cleanupMediaConnections","_cleanupParticipants","subRoomData","subRoom","user_id","subRoomsData","switchResponse","returnToMainRoom","sendMessage","text","trim","_generateMessageId","senderId","senderName","customData","messageEvent","deleteMessage","messageId","deleteEvent","m","updateMessage","newText","updateEvent","messageIndex","findIndex","updatedAt","sendTypingIndicator","isTyping","typingEvent","getMessages","limit","slice","getTypingUsers","clearMessages","addParticipant","memberData","Participant","_setupParticipantEvents","removeParticipant","getParticipant","getParticipants","pinParticipant","unpinParticipant","unpinnedParticipant","participantCount","subRoomCount","participantsData","participantData","AudioMixer","_setupLocalPublisher","_setupRemoteSubscriber","_setupStreamEventForwarding","webtpUrl","_handleServerEvent","Subscriber","streamOutputEnabled","onStatus","joinedParticipant","membership_id","sender","user","raised","p","roomData","random","toString","substr","_removeStreamEventForwarding","Room$1","SubRoom","parentRoom","maxParticipants","autoReturn","duration","startTime","isTemporary","allowSelfAssign","_setupSubRoomEvents","joinFromMain","_pauseMediaConnections","joinResult","_startDurationTimer","_resumeMediaConnections","targetSubRoom","fromSubRoom","toSubRoom","inviteParticipant","inviteToSubRoom","assignParticipant","assignToSubRoom","broadcastMessage","broadcastToSubRoom","getRemainingTime","elapsed","remaining","ceil","extendDuration","additionalMinutes","newDuration","setMaxParticipants","current","isFull","isEmpty","hasExpired","remainingTime","warningTime","remainingMinutes","_durationTimer","clearTimeout","remainingMs","_handleExpiry","serialize","participantIds","createdAt","fromSerializedData","SubRoom$1","ErmisClient$1","reconnectAttempts","reconnectDelay","ApiClient","isAuthenticated","currentRoom","rooms","defaultVideoConfig","defaultAudioConfig","channels","_setupEventHandlers","authenticate","_setConnectionStatus","test","tokenResponse","access_token","authenticatedAt","manualAuthenticate","logout","_ensureAuthenticated","_setupRoomEvents","autoJoin","r","getRooms","getCurrentRoom","getRoom","joinSubRoom","sr","mainRoom","previousSubRoom","switchSubRoom","targetSubRoomCode","currentSubRoom","to","getState","roomCount","getConfig","updateConfig","newConfig","enableDebug","disableDebug","_attemptReconnect","attempts","VERSION","wasm","cachedTextDecoder","ignoreBOM","fatal","cachedUint8ArrayMemory0","getUint8ArrayMemory0","memory","WASM_VECTOR_LEN","WasmEncoderFinalization","FinalizationRegistry","register","unregister","ptr","__wbg_wasmencoder_free","__wbg_get_imports","imports","wbg","__wbg_buffer_609cc3eee51ed158","arg0","__wbg_length_a446193dc22c12f8","__wbg_new_78feb108b6472713","__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a","arg1","arg2","__wbg_newwithlength_a381634e90c276d4","__wbg_push_737cfc8c1432c2c6","__wbg_set_65595bdd868b3009","__wbindgen_init_externref_table","table","__wbindgen_export_0","offset","grow","__wbindgen_memory","__wbindgen_throw","__wbg_init","module_or_path","Object","getPrototypeOf","prototype","URL","location","require","pathToFileURL","__filename","href","_documentCurrentScript","tagName","toUpperCase","baseURI","Request","instance","module","Response","WebAssembly","instantiateStreaming","arrayBuffer","instantiate","Instance","__wbg_load","exports","__wbindgen_wasm_module","__wbindgen_start","__wbg_finalize_init","__destroy_into_raw","__wbg_ptr","free","mtu","ptr0","arg","malloc","passArray8ToWasm0","__wbindgen_malloc","len0","ret","wasmencoder_new","repair_packets_count","wasmencoder_encode","getMTU","wasmencoder_getMTU","getConfigBuffer","wasmencoder_getConfigBuffer","create","ErmisClient","serverUrl","replace","client","version","events","CLIENT_AUTHENTICATED","CLIENT_AUTHENTICATION_FAILED","CLIENT_LOGGED_OUT","CLIENT_CONNECTION_STATUS_CHANGED","ROOM_CREATED","ROOM_JOINED","ROOM_LEFT","PARTICIPANT_ADDED","PARTICIPANT_REMOVED","PARTICIPANT_PINNED","PARTICIPANT_UNPINNED","AUDIO_TOGGLED","VIDEO_TOGGLED","HAND_RAISE_TOGGLED","REMOTE_AUDIO_STATUS_CHANGED","REMOTE_VIDEO_STATUS_CHANGED","REMOTE_HAND_RAISING_STATUS_CHANGED","SCREEN_SHARE_STARTED","SCREEN_SHARE_STOPPED","REMOTE_SCREEN_SHARE_STARTED","REMOTE_SCREEN_SHARE_STOPPED","PARTICIPANT_PINNED_FOR_EVERYONE","PARTICIPANT_UNPINNED_FOR_EVERYONE","SUB_ROOM_CREATED","SUB_ROOM_JOINED","SUB_ROOM_LEFT","SUB_ROOM_SWITCHED","LOCAL_STREAM_READY","REMOTE_STREAM_READY","STREAM_REMOVED","MESSAGE_SENT","MESSAGE_RECEIVED","MESSAGE_DELETED","MESSAGE_UPDATED","TYPING_STARTED","TYPING_STOPPED","CHAT_HISTORY_LOADED","ERROR","MediaDevices","getDevices","enumerateDevices","devices","cameras","d","microphones","speakers","checkPermissions","permissions","camera","query","microphone","RoomTypes","MAIN","BREAKOUT","PRESENTATION","DISCUSSION","ConnectionStatus","DISCONNECTED","CONNECTING","CONNECTED","FAILED","ParticipantRoles","OWNER","MODERATOR","PARTICIPANT","OBSERVER"],"mappings":"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"}